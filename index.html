<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Singknature ç¥žéŸ» Â· å¢¨è·¡ - Calligraphy Canvas</title>
    <!-- Favicon -->
    <link rel="icon" href="soft-pen-icon.png">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&family=Poppins:wght@400;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Custom Tailwind Config -->
    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            animation: {
              'fade-in': 'fadeIn 0.5s ease-out forwards',
              'slide-in-left': 'slideInFromLeft 0.5s ease-out forwards',
              'subtle-bob': 'subtleBob 3s ease-in-out infinite',
            },
            keyframes: {
              fadeIn: {
                '0%': { opacity: 0, transform: 'scale(0.95)' },
                '100%': { opacity: 1, transform: 'scale(1)' },
              },
              slideInFromLeft: {
                '0%': { transform: 'translateX(-100%)', opacity: 0 },
                '100%': { transform: 'translateX(0)', opacity: 1 },
              },
              subtleBob: {
                '0%, 100%': { transform: 'translateY(0)' },
                '50%': { transform: 'translateY(-8px)' },
              }
            },
            backgroundImage: {
              'grid-light': "url(\"data:image/svg+xml,%3csvg width='80' height='80' xmlns='http://www.w3.org/2000/svg'%3e%3cpath d='M0 40 L80 40 M40 0 L40 80' fill='none' stroke='rgba(200, 76, 76, 0.4)' stroke-width='1' stroke-dasharray='3 3'/%3e%3cpath d='M0 0 L80 0 L80 80 L0 80 L0 0 Z' fill='none' stroke='rgba(200, 76, 76, 0.4)' stroke-width='1'/%3e%3c/svg%3e\")",
              'grid-dark': "url(\"data:image/svg+xml,%3csvg width='100' height='100' xmlns='http://www.w3.org/2000/svg'%3e%3crect width='100' height='100' fill='%232a2a2a'/%3e%3cpath d='M0 50 L100 50 M50 0 L50 100' fill='none' stroke='%23333333' stroke-width='1' stroke-dasharray='1 1'/%3e%3c/svg%3e\")",
            },
            colors: {
              'paper': '#f8f5ef',
              'ink': '#3a3a3a',
              'ink-light': '#5a5a5a',
              'vermilion': '#c84c4c',
              'dark-bg': '#2a2a2a',
              'dark-text': '#d1cac1',
              'dark-ink': '#e0d9cf',
            },
            fontFamily: {
              'serif-sc': ['"Noto Serif SC"', 'serif'],
              'sans': ['Poppins', 'system-ui', 'sans-serif'],
            },
          },
        },
      }
    </script>
    
    <!-- JS Dependencies -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script type="importmap">
    {
      "imports": {
        "react": "https://aistudiocdn.com/react@^19.2.0",
        "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
        "react/": "https://aistudiocdn.com/react@^19.2.0/"
      }
    }
    </script>
</head>
<body class="bg-paper dark:bg-dark-bg">
    <svg width="0" height="0" style="position: absolute; left: -100%; top: -100%;">
      <defs>
        <clipPath id="rounded-hexagon" clipPathUnits="objectBoundingBox">
          <path d="M0.923205 0.4 L0.937939 0.431596 L0.946962 0.46527 L0.95 0.5 L0.946962 0.53473 L0.937939 0.568404 L0.923205 0.6 L0.798205 0.816506 L0.778209 0.845064 L0.753558 0.869715 L0.725 0.889711 L0.693404 0.904445 L0.65973 0.913468 L0.625 0.916506 L0.375 0.916506 L0.34027 0.913468 L0.306596 0.904445 L0.275 0.889711 L0.246442 0.869715 L0.221791 0.845064 L0.201795 0.816506 L0.0767949 0.6 L0.0620615 0.568404 L0.0530384 0.53473 L0.05 0.5 L0.0530384 0.46527 L0.0620615 0.431596 L0.0767949 0.4 L0.201795 0.183494 L0.221791 0.154936 L0.246442 0.130285 L0.275 0.110289 L0.306596 0.0955551 L0.34027 0.0865321 L0.375 0.0834936 L0.625 0.0834936 L0.65973 0.0865321 L0.693404 0.0955551 L0.725 0.110289 L0.753558 0.130285 L0.778209 0.154936 L0.798205 0.183494 Z" />
        </clipPath>
      </defs>
    </svg>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
      import React, { useState, useRef, useEffect, useCallback, forwardRef, useImperativeHandle } from 'react';
      import ReactDOM from 'react-dom/client';

      // =================================================================================
      // 1. TRANSLATIONS & CONFIG
      // =================================================================================
      const translations = {
        'zh-TW': {
          title: 'Singknature ç¥žéŸ» Â· å¢¨è·¡',
          menu: 'é¸å–®', closeMenu: 'é—œé–‰é¸å–®', openMenu: 'é–‹å•Ÿé¸å–®',
          howToUse: 'ä½¿ç”¨æ•™å­¸', videoTitle: 'ç¥žéŸ»Â·å¢¨è·¡ - æ•™å­¸å½±ç‰‡',
          draw: 'ç¹ªåœ–:', drawDesc: 'æŒ‰ä½æ»‘é¼ å·¦éµæˆ–ä½¿ç”¨æ‰‹æŒ‡/è§¸æŽ§ç­†åœ¨ç•«å¸ƒä¸Šæ‹–æ›³ã€‚',
          pan: 'å¹³ç§»:', panDesc: 'æŒ‰ä½æ»‘é¼ ä¸­éµæˆ–ä½¿ç”¨é›™æŒ‡åœ¨è§¸æŽ§æ¿ä¸Šæ‹–æ›³ã€‚',
          zoom: 'ç¸®æ”¾:', zoomDesc: 'ä½¿ç”¨æ»‘é¼ æ»¾è¼ªæˆ–é›™æŒ‡æåˆ/å¼µé–‹ã€‚',
          brushTip: 'ç­†è§¸ç²—ç´°æœƒæ ¹æ“šæ‚¨çš„ç¹ªç•«é€Ÿåº¦è‡ªå‹•è®ŠåŒ–ã€‚',
          aboutApp: 'é—œæ–¼ ç¥žéŸ»Â·å¢¨è·¡', aboutAppDesc: 'ä¸€å€‹ç‚ºæ°¸æ†æ›¸æ³•è—è¡“æ‰“é€ çš„æ•¸ä½è–æ®¿ã€‚é€™æ¬¾ PWA æ¨¡æ“¬äº†å‚³çµ±ç­†å¢¨çš„ç´°è†©é«”é©—ï¼Œå…¶æ¸²æŸ“å¼•æ“Žèƒ½æ„Ÿæ‡‰æ‚¨é‹ç­†çš„é€Ÿåº¦ã€‚ç„¡è«–æ‚¨æ˜¯ç¶“é©—è±å¯Œçš„æ›¸æ³•å®¶æˆ–åˆå­¸è€…ï¼Œéƒ½èƒ½åœ¨æ­¤éœå¿ƒç·´ç¿’ã€å‰µä½œï¼Œä¸¦æŽ¢ç´¢æ°´å¢¨ä¹‹ç¾Žã€‚',
          poweredByGemini: 'ä½¿ç”¨ Gemini 2.5 Pro è£½ä½œ',
          braveCompetition: 'åƒåŠ ã€Œ2025 .brave ç¶²ç«™è¨­è¨ˆå¤§è³½ã€',
          aboutAuthor: 'é—œæ–¼ä½œè€… Guanny', aboutAuthorDesc: 'Guanny æ˜¯ä¸€ä½å¯Œæœ‰å‰µé€ åŠ›çš„å‰ç«¯å·¥ç¨‹å¸«ï¼Œå°è—è¡“ã€æ–‡åŒ–èˆ‡ç§‘æŠ€çš„äº¤åŒ¯é»žæŠ±æŒè‘—æ·±åŽšçš„ç†±æƒ…ã€‚ä»–æ“æœ‰æ•éŠ³çš„ç¾Žå­¸è§¸è¦ºï¼Œä¸¦å°ˆæ³¨æ–¼ä»¥ä½¿ç”¨è€…ç‚ºä¸­å¿ƒçš„è¨­è¨ˆï¼Œè‡´åŠ›æ–¼æ‰“é€ ä¸åƒ…åŠŸèƒ½å¼·å¤§ï¼Œæ›´å¸¶æœ‰äººæ–‡æº«åº¦èˆ‡æ–‡åŒ–å…±é³´çš„æ²‰æµ¸å¼æ•¸ä½é«”é©—ã€‚',
          customColor: 'è‡ªè¨‚é¡è‰²', brushSize: 'ç­†åˆ·å¤§å°', waterAmount: 'æ°´é‡',
          undo: 'ä¸Šä¸€æ­¥', redo: 'ä¸‹ä¸€æ­¥', clear: 'æ¸…é™¤æ‰€æœ‰ç­†ç•«', download: 'ä¸‹è¼‰ä½œå“', downloadPNG: 'ä¸‹è¼‰ PNG', downloadSVG: 'ä¸‹è¼‰ SVG', chooseFormat: 'é¸æ“‡ä¸‹è¼‰æ ¼å¼',
          toggleTheme: 'åˆ‡æ›ä¸»é¡Œ', toggleLanguage: 'åˆ‡æ›èªžè¨€',
          setBrushColorInk: 'è¨­å®šç­†åˆ·é¡è‰²ç‚ºå¢¨è‰²', setBrushColorVermilion: 'è¨­å®šç­†åˆ·é¡è‰²ç‚ºæœ±ç´…è‰²',
          openColorPicker: 'é–‹å•Ÿè‡ªè¨‚é¡è‰²é¸æ“‡å™¨', uploadAsNFT: 'é‘„é€ ç‚º NFT',
          mintAsNFT: 'é‘„é€ ç‚º NFT', comingSoon: 'å³å°‡æŽ¨å‡º...', closeModal: 'é—œé–‰è¦–çª—',
          backToHome: 'è¿”å›žé¦–é ', instructions: 'ä½¿ç”¨èªªæ˜Ž',
          achieved: 'å·²é”æˆ',
          home: 'é¦–é ',
          canvas: 'ç•«æ¿',
          gallery: 'NFT ä½œå“é›†',
          fonts: 'æ›¸æ³•å­—å¸–',
          competition: 'Braveè©•åˆ†è¡¨',
          about: 'é—œæ–¼',
          wallet: 'éŒ¢åŒ…',
          connectWallet: 'é€£æŽ¥éŒ¢åŒ…',
          startCreating: 'é–‹å§‹å‰µä½œ',
          competitionNotice: 'ã€Œ2025 .brave ç¶²ç«™è¨­è¨ˆå¤§è³½ã€åƒè³½ä½œå“',
          learnMore: 'äº†è§£æ›´å¤š',
          braveScoringTitle: 'Brave è©•åˆ†æ¨™æº–',
          braveScoringIntro: 'æ‰€æœ‰ç¬¦åˆè³‡æ ¼çš„åƒè³½ä½œå“å°‡æ ¹æ“šå…¶çœŸæ­£å‹‡æ•¢çš„ç‰¹è³ªé€²è¡Œè©•ä¼°ï¼šå¼•äººå…¥å‹çš„å…§å®¹ã€ç„¡ç¸«çš„äº’å‹•æ€§ã€å‘¨åˆ°çš„è¨­è¨ˆä»¥åŠé«˜æ•ˆèƒ½çš„åŸ·è¡Œã€‚è«‹åƒé–±ä¸‹æ–¹çš„è©•åˆ†æ¨™æº–ï¼ˆæ»¿åˆ†100åˆ†ï¼‰ã€‚',
          scoringItem: 'é …ç›®',
          scoringMaxPoints: 'æœ€é«˜åˆ†æ•¸',
          scoringThisWebsite: 'æœ¬ç¶²ç«™',
          scoringContentMedia: 'å…§å®¹èˆ‡åª’é«”',
          scoringVideos: 'åµŒå…¥å½±ç‰‡',
          scoringImages: 'æœ‰æ•ˆä½¿ç”¨åœ–ç‰‡',
          scoringExtLinks: 'åŒ…å«å¤–éƒ¨é€£çµ',
          scoringCTAs: 'å‘ˆç¾æŒ‰éˆ•/è¡Œå‹•å‘¼ç±²',
          scoringSocial: 'ç¤¾ç¾¤åª’é«”æŒ‰éˆ•/é€£çµ',
          scoringIntegrations: 'æ•´åˆèˆ‡äº’å‹•æ€§',
          scoringBraveIntegrations: {
              title: 'Brave æ•´åˆï¼šæ•´åˆ Brave æˆ– BAT ç‰¹å®šåŠŸèƒ½ï¼Œä¾‹å¦‚ï¼š',
              item1: 'åœ¨æ”¯ä»˜ã€å°è²»ã€çŽå‹µæˆ–æ¿€å‹µä¸­ä½¿ç”¨ BAT',
              item2: 'Brave Search API ç«¯é»ž',
              item3: 'Brave éŒ¢åŒ…æˆ– Brave å»£å‘Šæ¦‚å¿µï¼ˆæ¨¡æ“¬æ•´åˆæˆ–æ¼”ç¤ºï¼‰'
          },
          scoringAnimations: 'å‹•ç•«/è½‰å ´æ•ˆæžœ',
          scoringNav: 'å¤šé é¢/æ¸…æ™°å°Žèˆª',
          scoringDesign: 'è¨­è¨ˆ',
          scoringLayout: 'ç‰ˆé¢èˆ‡è¦–è¦ºå¤–è§€',
          scoringBranding: 'å“ç‰Œ/åŽŸå‰µæ€§',
          scoringCopy: 'æ–‡æ¡ˆé•·åº¦èˆ‡æ˜“è®€æ€§',
          scoringFunctionality: 'åŠŸèƒ½æ€§èˆ‡æ•ˆèƒ½',
          scoringNoBrokenLinks: 'ç„¡å¤±æ•ˆé€£çµ',
          scoringMobile: 'è¡Œå‹•è£ç½®å‹å–„/éŸ¿æ‡‰å¼è¨­è¨ˆ',
          scoringMisc: 'å…¶ä»–',
          scoringOriginality: 'å‰µæ–°/åŽŸå‰µæ¦‚å¿µæˆ–è¨­è¨ˆå…ƒç´ ',
          voteForMe: 'æŠ•ç¥¨çµ¦æˆ‘',
          walletRequired: 'éœ€è¦ Web3 éŒ¢åŒ…',
          walletRequiredDesc: 'æ‚¨çš„ç€è¦½å™¨ä¼¼ä¹Žæ²’æœ‰å®‰è£ Web3 éŒ¢åŒ…ã€‚è«‹å®‰è£éŒ¢åŒ…æ“´å……åŠŸèƒ½å¾Œå†è©¦ä¸€æ¬¡ã€‚',
          braveWallet: 'å–å¾— Brave éŒ¢åŒ…',
          metaMask: 'å–å¾— MetaMask',
          binanceWallet: 'å–å¾—å¹£å®‰éŒ¢åŒ…',
          okxWallet: 'å–å¾— OKX éŒ¢åŒ…',
          phantomWallet: 'å–å¾— Phantom éŒ¢åŒ…',
          connectToMint: 'è«‹å…ˆé€£æŽ¥éŒ¢åŒ…',
          connectToMintDesc: 'æ‚¨éœ€è¦é€£æŽ¥éŒ¢åŒ…æ‰èƒ½é‘„é€  NFTã€‚',
          toggleControls: 'åˆ‡æ›å·¥å…·åˆ—',
          braveDonation: 'é—œæ–¼ BAT å°è²»',
          braveDonationDesc: '.brave åŸŸåç›®å‰å°šç„¡æ³•é€éŽ Brave Creator é€²è¡Œé©—è­‰ï¼Œä½†æˆ‘å€‘ä»æ­¡è¿Žæ‚¨é€éŽæ¨™æº–çš„ BAT å°è²»åŠŸèƒ½çµ¦äºˆæ”¯æŒã€‚éžå¸¸æ„Ÿè¬ï¼',
          visitBraveWallet: 'è¨ªå• Brave éŒ¢åŒ…',
          acknowledgements: 'è‡´è¬èˆ‡æŠ€è¡“æ£§',
          acknowledgementsDesc: 'ç¥žéŸ»Â·å¢¨è·¡çš„èª•ç”Ÿï¼Œé›¢ä¸é–‹é–‹æºç¤¾ç¾¤çš„åŠ›é‡èˆ‡æ™ºæ…§ã€‚é€™å€‹å°ˆæ¡ˆç«™åœ¨å·¨äººçš„è‚©è†€ä¸Šï¼Œèžåˆäº†çœ¾å¤šå„ªç§€çš„å·¥å…·èˆ‡è³‡æºã€‚æˆ‘å€‘åœ¨æ­¤å‘æ‰€æœ‰ç‚ºå…¶å¥ å®šåŸºç¤Žçš„é–‹ç™¼è€…ã€è¨­è¨ˆå¸«èˆ‡å‰µä½œè€…ï¼Œè‡´ä¸Šæœ€æ·±çš„æ•¬æ„èˆ‡æ„Ÿè¬ã€‚',
          techStack: 'ä¸»è¦æŠ€è¡“',
          assetsAndInspiration: 'è³‡æºèˆ‡éˆæ„Ÿ',
          authorAvatarCredit: 'ä½œè€…é ­åƒç”± Unstoppable Domains æä¾›',
          walletIconsCredit: 'éŒ¢åŒ…åœ–ç¤ºä¾†æºæ–¼ Wikimedia Commons ç­‰å¹³å°',
          inspirationCredit: 'ç­†è§¸æ¸²æŸ“éˆæ„Ÿä¾†è‡ª Atrament.js, Paper.js, three.js èˆ‡ç¤¾ç¾¤åˆ†äº«',
          viewOnGithub: 'åœ¨ GitHub ä¸ŠæŸ¥çœ‹åŽŸå§‹ç¢¼',
          featureUnavailable: 'åŠŸèƒ½å°šæœªé–‹æ”¾',
          featureUnavailableDesc: 'ç›¸é—œçš„æ™ºèƒ½åˆç´„å°šæœªéƒ¨ç½²ã€‚æ­¤åŠŸèƒ½å³å°‡æŽ¨å‡ºï¼Œæ•¬è«‹æœŸå¾…ï¼',
          fontsIntro: 'æ”¶éŒ„è‡ªå¤è‡³ä»Šå…·ä»£è¡¨æ€§çš„åä½æ›¸æ³•åå®¶ï¼Œæ¶µè“‹æ¥·ã€è¡Œã€è‰ã€éš¸ã€ç¯†äº”é«”ã€‚',
          searchPlaceholder: 'ä»¥ Brave æœå°‹æ›¸æ³•å®¶æˆ–ä½œå“...',
          searchButton: 'æœå°‹',
          loading: 'è¼‰å…¥ä¸­...',
          noResults: 'æ‰¾ä¸åˆ°çµæžœ',
          searchError: 'æœå°‹æ™‚ç™¼ç”ŸéŒ¯èª¤',
          braveSearchCredit: 'æœå°‹çµæžœç”± Brave Search æä¾›',
          calligraphers: [
            { id: 1, name: 'çŽ‹ç¾²ä¹‹', era: 'æ±æ™‰, 303ï¼361', portrait: 'https://bkimg.cdn.bcebos.com/pic/7af40ad162d9f2d3572c178caeba9d13632762d06600?x-bce-process=image/format,f_auto/quality,Q_70/resize,m_lfit,limit_1,w_536', works: [{ name: 'ã€ˆè˜­äº­åºã€‰', url: 'https://images1.epochhk.com/pictures/57658/300000673757131242125868223@1200x1200.jpg' }, { name: 'ã€ˆå¿«é›ªæ™‚æ™´å¸–ã€‰', url: 'https://theme.npm.edu.tw/khan/att/collection/03009165/17000136.jpg' }], style: 'ä¸»è¦é¢¨æ ¼ï¼šè¡Œæ›¸ã€æ¥·æ›¸å…¼æ“…ã€‚', features: 'é¢¨æ ¼ç‰¹è‰²ï¼šç­†å‹¢åœ“æ½¤æµæš¢ã€çµæ§‹åš´è¬¹ã€æ°£éŸ»ç”Ÿå‹•ï¼Œè¢«å°Šç‚ºã€Œæ›¸è–ã€ã€‚' },
            { id: 2, name: 'çŽ‹ç»ä¹‹', era: 'æ±æ™‰, 344ï¼386', portrait: 'https://bkimg.cdn.bcebos.com/pic/80cb39dbb6fd5266d016b5fbac56802bd40734fa9884?x-bce-process=image/format,f_auto', works: [{ name: 'ã€ˆä¸­ç§‹å¸–ã€‰', url: 'https://digitalarchive.npm.gov.tw/Image/GetImage?imageId=463451&randomCode=14594599283' }, { name: 'ã€ˆé´¨é ­ä¸¸å¸–ã€‰', url: 'https://digitalarchive.npm.gov.tw/Image/GetImage?imageId=478972&randomCode=82271322860' }], style: 'ä¸»è¦é¢¨æ ¼ï¼šè¡Œè‰æ›¸ã€‚', features: 'é¢¨æ ¼ç‰¹è‰²ï¼šè‡ªç”±ç‘è„«ã€ç­†ç•«éˆå‹•ï¼›é¢¨æ ¼ç¹¼æ‰¿çˆ¶æ³•è€Œæ›´å¯Œè®ŠåŒ–ã€‚' },
            { id: 3, name: 'æ­é™½è©¢', era: 'å”, 557ï¼641', portrait: 'https://qqpublic.qpic.cn/qq_public/0/28-642000311-5E8A5145D6567DB5A4F7314B01FB190F/900?fmt=jpg&h=896&ppv=1&size=38&w=640', works: [{ name: 'ã€ˆä¹æˆå®®é†´æ³‰éŠ˜ã€‰', url: 'https://digitalarchive.npm.gov.tw/Image/GetImage?imageId=503778&randomCode=11746109269' }, { name: 'ã€ˆåŒ–åº¦å¯ºç¢‘ã€‰', url: 'https://digitalarchive.npm.gov.tw/Image/GetImage?imageId=478670&randomCode=72757397780' }], style: 'ä¸»è¦é¢¨æ ¼ï¼šæ¥·æ›¸ã€‚', features: 'é¢¨æ ¼ç‰¹è‰²ï¼šã€Œæ­é«”ã€ç­†æ³•åš´è¬¹ã€æ³•åº¦æ£®ç„¶ï¼Œæ˜¯æ¥·æ›¸åˆå­¸è€…å…¸ç¯„ã€‚' },
            { id: 4, name: 'é¡çœŸå¿', era: 'å”, 709ï¼785', portrait: 'https://upload.wikimedia.org/wikipedia/commons/9/9a/%E5%94%90%E5%90%8D%E8%87%A3%E5%83%8F-13-%E9%A1%94%E9%AD%AF%E5%85%AC.png', works: [{ name: 'ã€ˆå¤šå¯¶å¡”ç¢‘ã€‰', url: 'https://upload.wikimedia.org/wikipedia/commons/thumb/9/97/%E5%A4%9A%E5%AE%9D%E5%A1%94%E7%A2%91.%E5%94%90.%E9%A2%9C%E7%9C%9F%E5%8D%BF.%E4%B9%A6.%E5%8C%97%E5%AE%8B%E6%8B%93%E6%9C%AC.%E4%B8%9C%E4%BA%AC%E5%9B%BD%E7%AB%8B%E5%8D%9A%E7%89%A9%E9%A6%86%E8%97%8F.pdf/page6-942px-%E5%A4%9A%E5%AE%9D%E5%A1%94%E7%A2%91.%E5%94%90.%E9%A2%9C%E7%9C%9F%E5%8D%BF.%E4%B9%A6.%E5%8C%97%E5%AE%8B%E6%8B%93%E6%9C%AC.%E4%B8%9C%E4%BA%AC%E5%9B%BD%E7%AB%8B%E5%8D%9A%E7%89%A9%E9%A6%86%E8%97%8F.pdf.jpg' }, { name: 'ã€ˆç¥­ä¾„æ–‡ç¨¿ã€‰', url: 'https://digitalarchive.npm.gov.tw/Image/GetImage?imageId=519371&randomCode=85156012033' }], style: 'ä¸»è¦é¢¨æ ¼ï¼šæ¥·æ›¸ã€è¡Œæ›¸ã€‚', features: 'é¢¨æ ¼ç‰¹è‰²ï¼šé›„æ¸¾åŽšé‡ã€æ°£å‹¢èŽŠåš´ã€æƒ…æ„ŸçœŸæ‘¯ï¼›é–‹å‰µã€Œé¡é«”ã€ã€‚' },
            { id: 5, name: 'æŸ³å…¬æ¬Š', era: 'å”, 778ï¼865', portrait: 'https://upload.wikimedia.org/wikipedia/commons/8/83/%E6%9F%B3%E5%85%AC%E6%9D%83.jpg', works: [{ name: 'ã€ˆçŽ„ç§˜å¡”ç¢‘ã€‰', url: 'https://digitalarchive.npm.gov.tw/Image/GetImage?imageId=502860&randomCode=79365349114' }, { name: 'ã€ˆç¥žç­–è»ç¢‘ã€‰', url: 'https://upload.wikimedia.org/wikipedia/commons/thumb/4/4b/%E5%94%90_%E6%9F%B3%E5%85%AC%E6%9D%83_%E7%A5%9E%E7%AD%96%E5%86%9B%E7%A2%91.pdf/page1-700px-%E5%94%90_%E6%9F%B3%E5%85%AC%E6%9D%83_%E7%A5%9E%E7%AD%96%E5%86%9B%E7%A2%91.pdf.jpg' }], style: 'ä¸»è¦é¢¨æ ¼ï¼šæ¥·æ›¸ã€‚', features: 'é¢¨æ ¼ç‰¹è‰²ï¼šã€ŒæŸ³éª¨é¡è‚‰ã€ï¼›ç­†å‹æŒºæ‹”ã€éª¨åŠ›å¼·å¥ã€çµæ§‹åš´æ•´ã€‚' },
            { id: 6, name: 'è˜‡è»¾', era: 'åŒ—å®‹, 1037ï¼1101', portrait: 'https://bkimg.cdn.bcebos.com/pic/b812c8fcc3cec3fdfc03b0c446dac33f8794a4c2897a', works: [{ name: 'ã€ˆå¯’é£Ÿå¸–ã€‰', url: 'https://theme.npm.edu.tw/exh106/npm_anime/ColdFoodObservance/common/images/selection/img1_1s.jpg' }, { name: 'ã€ˆé»ƒå·žå¯’é£Ÿè©©å¸–ã€‰', url: 'https://digitalarchive.npm.gov.tw/Image/GetImage?imageId=1856294&randomCode=221892128' }], style: 'ä¸»è¦é¢¨æ ¼ï¼šè¡Œæ›¸ã€è‰æ›¸ã€‚', features: 'é¢¨æ ¼ç‰¹è‰²ï¼šç‘è„«è‡ªç„¶ã€è©©æ„ç›Žç„¶ï¼Œç‚ºã€Œå®‹å››å®¶ã€ä¹‹ä¸€ã€‚' },
            { id: 7, name: 'ç±³èŠ¾', era: 'åŒ—å®‹, 1051ï¼1107', portrait: 'http://img.mp.sohu.com/upload/20170712/0dcbcf492f434adca8c87480bbc3bbb5_th.png', works: [{ name: 'ã€ˆèœ€ç´ å¸–ã€‰', url: 'https://theme.npm.edu.tw/selection/att/collection/04001010/17010211.jpg' }, { name: 'ã€ˆè‹•æºªè©©å¸–ã€‰', url: 'https://digitalarchive.npm.gov.tw/Image/GetImage?imageId=456925&randomCode=48645796130' }], style: 'ä¸»è¦é¢¨æ ¼ï¼šè¡Œæ›¸ã€è‰æ›¸ã€‚', features: 'é¢¨æ ¼ç‰¹è‰²ï¼šå¥”æ”¾å¤šè®Šã€ç¯€å¥å¼·çƒˆã€è‡ªæˆã€Œç±³ç™²ã€é¢¨æ ¼ã€‚' },
            { id: 8, name: 'è¶™å­Ÿé «', era: 'å…ƒ, 1254ï¼1322', portrait: 'https://upload.wikimedia.org/wikipedia/commons/thumb/8/86/%E8%B6%99%E9%AD%8F%E5%85%AC%E5%B0%8F%E5%83%8F.jpg/250px-%E8%B6%99%E9%AD%8F%E5%85%AC%E5%B0%8F%E5%83%8F.jpg', works: [{ name: 'ã€ˆè†½å·´ç¢‘ã€‰', url: 'https://b.sfzd.cn/upload/20150515/14316755333637.jpg' }, { name: 'ã€ˆçŽ„å¦™è§€é‡ä¿®ä¸‰é–€è¨˜ã€‰', url: 'https://b.sfzd.cn/upload/20150401/14278768136037.jpg' }], style: 'ä¸»è¦é¢¨æ ¼ï¼šæ¥·æ›¸ã€è¡Œæ›¸ã€‚', features: 'é¢¨æ ¼ç‰¹è‰²ï¼šç§€æ½¤å…¸é›…ã€åœ“ä¸­å¸¶å‰›ï¼›å€¡å°Žã€Œå¾©å¤ã€ä¹‹ç¾Žã€‚' },
            { id: 9, name: 'äºŽå³ä»»', era: 'è¿‘ç¾ä»£, 1879ï¼1964', portrait: 'https://upload.wikimedia.org/wikipedia/commons/thumb/4/45/%E4%BA%8E%E5%8F%B3%E4%BB%BB%E8%82%96%E5%83%8F%E7%85%A7.jpg/330px-%E4%BA%8E%E5%8F%B3%E4%BB%BB%E8%82%96%E5%83%8F%E7%85%A7.jpg', works: [{ name: 'ã€ˆæ¨™æº–è‰æ›¸åƒå­—æ–‡ã€‰', url: 'https://p4.itc.cn/images01/20201121/e6c21707a1bd4689bce222e58320e9bd.jpeg' }, { name: 'ã€ˆè‰æ›¸é¸ã€‰', url: 'https://d1i8d984en2aby.cloudfront.net/products/cptw/704/conversions/14222040B-product_preview.webp' }], style: 'ä¸»è¦é¢¨æ ¼ï¼šè‰æ›¸ã€‚', features: 'é¢¨æ ¼ç‰¹è‰²ï¼šå‰µç«‹ã€Œæ¨™æº–è‰æ›¸ã€ï¼Œçµåˆå¤æ³•èˆ‡ç¾ä»£æ›¸æ„ã€‚' },
            { id: 10, name: 'å•ŸåŠŸ', era: 'ç¾ä»£, 1912ï¼2005', portrait: 'https://bkimg.cdn.bcebos.com/pic/b8014a90f603738da977cf294456a751f81986184623?x-bce-process=image/format,f_auto', works: [{ name: 'ã€ˆæ›¸æ³•é›†ã€‰', url: 'https://d2onjhd726mt7c.cloudfront.net/images/auction/AF000031/8818/L800/3265.jpg' }], style: 'ä¸»è¦é¢¨æ ¼ï¼šè¡Œæ¥·æ›¸ã€‚', features: 'é¢¨æ ¼ç‰¹è‰²ï¼šæ–‡äººæ›¸é¢¨ã€ç§€æ½¤æ¸…æ–°ï¼›ç­†ç•«å‹»ç¨±ã€ç¯€å¥ç©©å¥ã€‚' }
          ]
        },
        'en': {
          title: 'Singknature ç¥žéŸ» Â· å¢¨è·¡',
          menu: 'Menu', closeMenu: 'Close Menu', openMenu: 'Open Menu',
          howToUse: 'How to Use', videoTitle: 'Signknature Canvas - Tutorial Video',
          draw: 'Draw:', drawDesc: 'Press and hold the left mouse button, or use your finger/stylus to drag on the canvas.',
          pan: 'Pan:', panDesc: 'Press and hold the middle mouse button, or use two fingers to drag on the trackpad.',
          zoom: 'Zoom:', zoomDesc: 'Use the mouse wheel or a two-finger pinch/spread gesture.',
          brushTip: 'The brush stroke thickness varies automatically with your drawing speed.',
          aboutApp: 'About Signknature', aboutAppDesc: "A digital sanctuary for the timeless art of calligraphy. This PWA simulates the nuanced experience of traditional brush and ink, with a rendering engine that responds to your stroke's velocity. A serene space to practice, create, and explore the profound beauty of ink on paper, right from your browser.",
          poweredByGemini: 'Made with Gemini 2.5 Pro',
          braveCompetition: 'Participating in the "2025 .brave Website Competition"',
          aboutAuthor: 'About the Author, Guanny', aboutAuthorDesc: "Guanny is a creative frontend engineer with a profound passion for the intersection of art, culture, and technology. With a keen eye for aesthetics and a dedication to user-centric design, he strives to build immersive digital experiences that are not only functional but also carry a touch of human warmth and cultural resonance.",
          customColor: 'Custom Color', brushSize: 'Brush Size', waterAmount: 'Water Amount',
          undo: 'Undo', redo: 'Redo', clear: 'Clear All', download: 'Download Artwork', downloadPNG: 'Download PNG', downloadSVG: 'Download SVG', chooseFormat: 'Choose Format',
          toggleTheme: 'Toggle Theme', toggleLanguage: 'Toggle Language',
          setBrushColorInk: 'Set brush color to Ink', setBrushColorVermilion: 'Set brush color to Vermilion',
          openColorPicker: 'Open custom color picker', uploadAsNFT: 'Mint as NFT',
          mintAsNFT: 'Mint as NFT', comingSoon: 'Coming Soon...', closeModal: 'Close Modal',
          backToHome: 'Back to Home', instructions: 'Instructions',
          achieved: 'Achieved',
          home: 'Home',
          canvas: 'Canvas',
          gallery: 'NFT Gallery',
          fonts: 'Calligraphy Copybooks',
          competition: 'Brave Scoring',
          about: 'About',
          wallet: 'Wallet',
          connectWallet: 'Connect Wallet',
          startCreating: 'Start Creating',
          competitionNotice: 'Entry for the "2025 .brave Website Design Contest"',
          learnMore: 'Learn More',
          braveScoringTitle: 'Brave Scoring Framework',
          braveScoringIntro: 'All eligible submissions will be evaluated on what makes them truly brave: engaging content, seamless interactivity, thoughtful design, and high-performance execution. Explore the scoring framework (out of 100) below.',
          scoringItem: 'Item',
          scoringMaxPoints: 'Maximum Points',
          scoringThisWebsite: 'This Website',
          scoringContentMedia: 'Content & Media',
          scoringVideos: 'Videos embedded',
          scoringImages: 'Images used effectively',
          scoringExtLinks: 'External links included',
          scoringCTAs: 'Buttons/CTAs present',
          scoringSocial: 'Social media buttons/links',
          scoringIntegrations: 'Integrations & Interactivity',
          scoringBraveIntegrations: {
              title: 'Brave Integrations: Integrate Brave- or BAT-specific features such as:',
              item1: 'BAT in payments, tipping, rewards, or incentives',
              item2: 'Brave Search API endpoint',
              item3: 'Brave Wallet or Brave Ads concepts (mock integrations or demos)'
          },
          scoringAnimations: 'Animation/Transitions',
          scoringNav: 'Multiple pages/clear navigation',
          scoringDesign: 'Design',
          scoringLayout: 'Layout & Visual Appearance',
          scoringBranding: 'Branding/Originality',
          scoringCopy: 'Copy length & Legibility',
          scoringFunctionality: 'Functionality & Performance',
          scoringNoBrokenLinks: 'No broken links',
          scoringMobile: 'Mobile Friendly/Responsiveness',
          scoringMisc: 'Miscellaneous',
          scoringOriginality: 'Out of the box/original concepts or design elements',
          voteForMe: 'Vote for Me',
          walletRequired: 'Web3 Wallet Required',
          walletRequiredDesc: 'It seems your browser does not have a Web3 wallet installed. Please install a wallet extension to continue.',
          braveWallet: 'Get Brave Wallet',
          metaMask: 'Get MetaMask',
          binanceWallet: 'Get Binance Wallet',
          okxWallet: 'Get OKX Wallet',
          phantomWallet: 'Get Phantom Wallet',
          connectToMint: 'Please Connect Wallet',
          connectToMintDesc: 'You need to connect your wallet to mint an NFT.',
          toggleControls: 'Toggle Controls',
          braveDonation: 'About BAT Tipping',
          braveDonationDesc: '.brave domains cannot be verified through Brave Creators at this time. However, we still welcome your support via the standard BAT tipping feature. Thank you!',
          visitBraveWallet: 'Visit Brave Wallet',
          acknowledgements: 'Acknowledgements & Tech Stack',
          acknowledgementsDesc: 'Singknature is brought to life by the power and wisdom of the open-source community. This project stands on the shoulders of giants, integrating a multitude of excellent tools and resources. We extend our deepest respect and gratitude to all the developers, designers, and creators who laid the groundwork for its existence.',
          techStack: 'Core Technologies',
          assetsAndInspiration: 'Assets & Inspiration',
          authorAvatarCredit: 'Author avatar provided by Unstoppable Domains',
          walletIconsCredit: 'Wallet icons sourced from platforms like Wikimedia Commons',
          inspirationCredit: 'Stroke rendering inspired by Atrament.js, Paper.js, three.js and community shares',
          viewOnGithub: 'View Source on GitHub',
          featureUnavailable: 'Feature Not Available',
          featureUnavailableDesc: 'The related smart contract has not been deployed yet. This feature is coming soon, please stay tuned!',
          fontsIntro: 'Featuring ten representative calligraphers from ancient to modern times, covering five major scripts: Regular, Cursive, Semi-cursive, Clerical, and Seal.',
          searchPlaceholder: 'Search calligraphers or works with Brave...',
          searchButton: 'Search',
          loading: 'Loading...',
          noResults: 'No results found.',
          searchError: 'An error occurred while searching.',
          braveSearchCredit: 'Search results powered by Brave Search',
          calligraphers: [
            { id: 1, name: 'Wang Xizhi', era: 'Eastern Jin, 303â€“361', portrait: 'https://bkimg.cdn.bcebos.com/pic/7af40ad162d9f2d3572c178caeba9d13632762d06600?x-bce-process=image/format,f_auto/quality,Q_70/resize,m_lfit,limit_1,w_536', works: [{ name: 'Preface to the Orchid Pavilion', url: 'https://images1.epochhk.com/pictures/57658/300000673757131242125868223@1200x1200.jpg' }, { name: 'Timely Clearing After Snowfall', url: 'https://theme.npm.edu.tw/khan/att/collection/03009165/17000136.jpg' }], style: 'Main Style: Cursive and Regular scripts.', features: 'Style Features: Revered as the "Sage of Calligraphy," his brushwork is fluid and rounded, with a rigorous structure and lively spirit.' },
            { id: 2, name: 'Wang Xianzhi', era: 'Eastern Jin, 344â€“386', portrait: 'https://bkimg.cdn.bcebos.com/pic/80cb39dbb6fd5266d016b5fbac56802bd40734fa9884?x-bce-process=image/format,f_auto', works: [{ name: 'Mid-Autumn Letter', url: 'https://digitalarchive.npm.gov.tw/Image/GetImage?imageId=463451&randomCode=14594599283' }, { name: 'Duck Head Pill Letter', url: 'https://digitalarchive.npm.gov.tw/Image/GetImage?imageId=478972&randomCode=82271322860' }], style: 'Main Style: Cursive and Semi-cursive scripts.', features: 'Style Features: Free and unrestrained, with agile strokes; his style builds on his father\'s foundation but with greater variation.' },
            { id: 3, name: 'Ouyang Xun', era: 'Tang, 557â€“641', portrait: 'https://qqpublic.qpic.cn/qq_public/0/28-642000311-5E8A5145D6567DB5A4F7314B01FB190F/900?fmt=jpg&h=896&ppv=1&size=38&w=640', works: [{ name: 'Jiucheng Palace Sweet Spring', url: 'https://digitalarchive.npm.gov.tw/Image/GetImage?imageId=503778&randomCode=11746109269' }, { name: 'Stele of the Huadu Temple', url: 'https://digitalarchive.npm.gov.tw/Image/GetImage?imageId=478670&randomCode=72757397780' }], style: 'Main Style: Regular script.', features: 'Style Features: The "Ou style" is characterized by its rigorous and precise brushwork, serving as a model for beginners.' },
            { id: 4, name: 'Yan Zhenqing', era: 'Tang, 709â€“785', portrait: 'https://upload.wikimedia.org/wikipedia/commons/9/9a/%E5%94%90%E5%90%8D%E8%87%A3%E5%83%8F-13-%E9%A1%94%E9%AD%AF%E5%85%AC.png', works: [{ name: 'Stele of the Duobao Pagoda', url: 'https://upload.wikimedia.org/wikipedia/commons/thumb/9/97/%E5%A4%9A%E5%AE%9D%E5%A1%94%E7%A2%91.%E5%94%90.%E9%A2%9C%E7%9C%9F%E5%8D%BF.%E4%B9%A6.%E5%8C%97%E5%AE%8B%E6%8B%93%E6%9C%AC.%E4%B8%9C%E4%BA%AC%E5%9B%BD%E7%AB%8B%E5%8D%9A%E7%89%A9%E9%A6%86%E8%97%8F.pdf/page6-942px-%E5%A4%9A%E5%AE%9D%E5%A1%94%E7%A2%91.%E5%94%90.%E9%A2%9C%E7%9C%9F%E5%8D%BF.%E4%B9%A6.%E5%8C%97%E5%AE%8B%E6%8B%93%E6%9C%AC.%E4%B8%9C%E4%BA%AC%E5%9B%BD%E7%AB%8B%E5%8D%9A%E7%89%A9%E9%A6%86%E8%97%8F.pdf.jpg' }, { name: 'Draft of a Requiem to My Nephew', url: 'https://digitalarchive.npm.gov.tw/Image/GetImage?imageId=519371&randomCode=85156012033' }], style: 'Main Style: Regular and Cursive scripts.', features: 'Style Features: Majestic, solid, and dignified, with sincere emotion; he pioneered the "Yan style."' },
            { id: 5, name: 'Liu Gongquan', era: 'Tang, 778â€“865', portrait: 'https://upload.wikimedia.org/wikipedia/commons/8/83/%E6%9F%B3%E5%85%AC%E6%9D%83.jpg', works: [{ name: 'Stele of the Xuanmi Pagoda', url: 'https://digitalarchive.npm.gov.tw/Image/GetImage?imageId=502860&randomCode=79365349114' }, { name: 'Stele of the Shence Army', url: 'https://upload.wikimedia.org/wikipedia/commons/thumb/4/4b/%E5%94%90_%E6%9F%B3%E5%85%AC%E6%9D%83_%E7%A5%9E%E7%AD%96%E5%86%9B%E7%A2%91.pdf/page1-700px-%E5%94%90_%E6%9F%B3%E5%85%AC%E6%9D%83_%E7%A5%9E%E7%AD%96%E5%86%9B%E7%A2%91.pdf.jpg' }], style: 'Main Style: Regular script.', features: 'Style Features: Known for "Liu\'s bones, Yan\'s flesh"; his strokes are sharp and strong, with a well-structured framework.' },
            { id: 6, name: 'Su Shi', era: 'Northern Song, 1037â€“1101', portrait: 'https://bkimg.cdn.bcebos.com/pic/b812c8fcc3cec3fdfc03b0c446dac33f8794a4c2897a', works: [{ name: 'Cold Food Scroll', url: 'https://theme.npm.edu.tw/exh106/npm_anime/ColdFoodObservance/common/images/selection/img1_1s.jpg' }, { name: 'Huangzhou Cold Food Poem', url: 'https://digitalarchive.npm.gov.tw/Image/GetImage?imageId=1856294&randomCode=221892128' }], style: 'Main Style: Cursive and Semi-cursive scripts.', features: 'Style Features: Natural and unrestrained, filled with poetic charm; one of the "Four Masters of the Song Dynasty."' },
            { id: 7, name: 'Mi Fu', era: 'Northern Song, 1051â€“1107', portrait: 'http://img.mp.sohu.com/upload/20170712/0dcbcf492f434adca8c87480bbc3bbb5_th.png', works: [{ name: 'Poem on Sichuan Silk', url: 'https://theme.npm.edu.tw/selection/att/collection/04001010/17010211.jpg' }, { name: 'Poems from the Tiaoxi Stream', url: 'https://digitalarchive.npm.gov.tw/Image/GetImage?imageId=456925&randomCode=48645796130' }], style: 'Main Style: Cursive and Semi-cursive scripts.', features: 'Style Features: Dynamic and varied, with a strong sense of rhythm, creating his own "Mi the Madman" style.' },
            { id: 8, name: 'Zhao Mengfu', era: 'Yuan, 1254â€“1322', portrait: 'https://upload.wikimedia.org/wikipedia/commons/thumb/8/86/%E8%B6%99%E9%AD%8F%E5%85%AC%E5%B0%8F%E5%83%8F.jpg/250px-%E8%B6%99%E9%AD%8F%E5%85%AC%E5%B0%8F%E5%83%8F.jpg', works: [{ name: 'Danba Stele', url: 'https://b.sfzd.cn/upload/20150515/14316755333637.jpg' }, { name: 'Reconstruction of Xuanmiao Temple', url: 'https://b.sfzd.cn/upload/20150401/14278768136037.jpg' }], style: 'Main Style: Regular and Cursive scripts.', features: 'Style Features: Elegant and graceful, with strength within roundness; he advocated for "reviving ancient styles."' },
            { id: 9, name: 'Yu Youren', era: 'Modern, 1879â€“1964', portrait: 'https://upload.wikimedia.org/wikipedia/commons/thumb/4/45/%E4%BA%8E%E5%8F%B3%E4%BB%BB%E8%82%96%E5%83%8F%E7%85%A7.jpg/330px-%E4%BA%8E%E5%8F%B3%E4%BB%BB%E8%82%96%E5%83%8F%E7%85%A7.jpg', works: [{ name: 'Standard Cursive Thousand Character Classic', url: 'https://p4.itc.cn/images01/20201121/e6c21707a1bd4689bce222e58320e9bd.jpeg' }, { name: 'Selected Cursive Works', url: 'https://d1i8d984en2aby.cloudfront.net/products/cptw/704/conversions/14222040B-product_preview.webp' }], style: 'Main Style: Cursive script.', features: 'Style Features: Created "Standard Cursive Script," blending ancient methods with modern aesthetics.' },
            { id: 10, name: 'Qi Gong', era: 'Modern, 1912â€“2005', portrait: 'https://bkimg.cdn.bcebos.com/pic/b8014a90f603738da977cf294456a751f81986184623?x-bce-process=image/format,f_auto', works: [{ name: 'Calligraphy Collection', url: 'https://d2onjhd726mt7c.cloudfront.net/images/auction/AF000031/8818/L800/3265.jpg' }], style: 'Main Style: Running-Regular script.', features: 'Style Features: A scholar\'s style, elegant and fresh; his strokes are balanced, and his rhythm is steady.' }
          ]
        }
      };

      // =================================================================================
      // 2. HELPER FUNCTIONS & HOOKS
      // =================================================================================
      const useWindowSize = () => {
          const [size, setSize] = useState({ width: 0, height: 0 });
          useEffect(() => {
              const handleResize = () => setSize({ width: window.innerWidth, height: window.innerHeight });
              window.addEventListener('resize', handleResize);
              handleResize();
              return () => window.removeEventListener('resize', handleResize);
          }, []);
          return size;
      };
      const hsvToRgb = (h, s, v) => {
          let r, g, b; let i = Math.floor(h * 6); let f = h * 6 - i; let p = v * (1 - s); let q = v * (1 - f * s); let t = v * (1 - (1 - f) * s);
          switch (i % 6) {
              case 0: r = v; g = t; b = p; break; case 1: r = q; g = v; b = p; break; case 2: r = p; g = v; b = t; break;
              case 3: r = p; g = q; b = v; break; case 4: r = t; g = p; b = v; break; case 5: r = v; g = p; b = q; break;
          }
          return { r: Math.round(r * 255), g: Math.round(g * 255), b: Math.round(b * 255) };
      };
      const rgbToHsv = (r, g, b) => {
          r /= 255; g /= 255; b /= 255;
          let max = Math.max(r, g, b), min = Math.min(r, g, b); let h, s, v = max; let d = max - min;
          s = max === 0 ? 0 : d / max;
          if (max === min) { h = 0; } else {
              switch (max) {
                  case r: h = (g - b) / d + (g < b ? 6 : 0); break; case g: h = (b - r) / d + 2; break; case b: h = (r - g) / d + 4; break;
              }
              h /= 6;
          }
          return { h, s, v };
      };
      const parseColor = (colorString) => {
          let r = 0, g = 0, b = 0, a = 1;
          let match = colorString.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*([\d.]+))?\)$/);
          if (match) {
              r = parseInt(match[1]); g = parseInt(match[2]); b = parseInt(match[3]); a = match[4] !== undefined ? parseFloat(match[4]) : 1;
          } else {
              const ctx = document.createElement('canvas').getContext('2d');
              if (ctx) {
                  ctx.fillStyle = colorString; const hexWithHash = ctx.fillStyle;
                  match = hexWithHash.match(/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i);
                  if (match) { r = parseInt(match[1], 16); g = parseInt(match[2], 16); b = parseInt(match[3], 16); }
              }
          }
          const { h, s, v } = rgbToHsv(r, g, b);
          return { r, g, b, a, h, s, v };
      };
      const useDraggable = (ref, onDrag) => {
          const isDraggingRef = useRef(false);
          const getCoords = (e) => e.touches ? { clientX: e.touches[0].clientX, clientY: e.touches[0].clientY } : { clientX: e.clientX, clientY: e.clientY };
          const handleDrag = useCallback((e) => {
              if (isDraggingRef.current) {
                  if (e.touches) e.preventDefault();
                  const { clientX, clientY } = getCoords(e); const rect = ref.current.getBoundingClientRect();
                  const x = Math.max(0, Math.min(clientX - rect.left, rect.width)); const y = Math.max(0, Math.min(clientY - rect.top, rect.height));
                  onDrag({ x, y, width: rect.width, height: rect.height });
              }
          }, [ref, onDrag]);
          const handleDragEnd = useCallback(() => {
              isDraggingRef.current = false;
              window.removeEventListener('mousemove', handleDrag); window.removeEventListener('mouseup', handleDragEnd);
              window.removeEventListener('touchmove', handleDrag); window.removeEventListener('touchend', handleDragEnd);
          }, [handleDrag]);
          const handleDragStart = useCallback((e) => {
              isDraggingRef.current = true; const { clientX, clientY } = getCoords(e); const rect = ref.current.getBoundingClientRect();
              const x = Math.max(0, Math.min(clientX - rect.left, rect.width)); const y = Math.max(0, Math.min(clientY - rect.top, rect.height));
              onDrag({ x, y, width: rect.width, height: rect.height });
              window.addEventListener('mousemove', handleDrag); window.addEventListener('mouseup', handleDragEnd);
              window.addEventListener('touchmove', handleDrag, { passive: false }); window.addEventListener('touchend', handleDragEnd);
          }, [ref, onDrag, handleDrag, handleDragEnd]);
          return { onMouseDown: handleDragStart, onTouchStart: handleDragStart };
      };

      // =================================================================================
      // 3. ICON & SMALL UI COMPONENTS
      // =================================================================================
      const BrandIcon = ({ className }) => (
        <svg xmlns="http://www.w3.org/2000/svg" className={className} viewBox="0 0 992 992" fill="currentColor">
          <path d="M538.677063,454.678040 C567.945679,423.391663 597.472961,392.839752 627.279175,362.565704 C684.096802,304.856140 741.196228,247.420334 802.218811,194.078995 C820.279419,178.291809 838.578003,162.749756 859.242615,150.323639 C863.689392,147.649719 868.250244,145.220688 873.382935,144.177368 C878.881042,143.059753 882.202271,145.630219 882.239319,151.279694 C882.304871,161.269363 877.943420,170.072540 873.903687,178.781570 C856.096924,217.170197 833.382629,252.636536 808.700623,286.895721 C775.646423,332.775940 739.491821,376.122131 701.755310,418.200684 C659.575989,465.233154 615.597107,510.511688 570.189697,554.417480 C563.242310,561.135010 556.237244,567.793640 549.198669,574.415527 C547.935852,575.603516 546.968201,577.416748 544.010132,577.240784 C546.724976,559.556885 540.441528,544.677612 528.841553,531.861511 C517.169678,518.965942 502.506714,512.580261 484.583710,514.087280 C484.456635,513.533386 484.329559,512.979431 484.202484,512.425537 C502.280670,493.262848 520.358826,474.100189 538.677063,454.678040 z"></path>
          <path d="M412.601379,733.497559 C399.969421,755.813904 380.384369,768.574158 357.005249,776.163818 C313.032654,790.438965 271.580017,783.342407 232.036346,760.920410 C222.594864,755.566895 213.561829,749.624634 205.402405,742.434021 C203.580414,740.828369 201.472580,739.372742 200.835266,736.353088 C203.335983,735.319397 205.740845,736.153137 208.125687,736.282593 C230.089935,737.474670 251.006241,734.121155 269.538513,721.372864 C282.502930,712.454712 290.823608,699.996887 295.719147,685.185852 C298.380737,677.133545 300.242065,668.783569 304.840607,661.483459 C314.383606,646.334106 328.341309,638.080078 345.906708,636.302368 C371.922943,633.669373 394.435181,641.564453 411.759247,661.364685 C424.286438,675.682373 423.772491,693.244751 420.898315,710.728882 C419.599915,718.627380 416.791321,726.164490 412.601379,733.497559 z"></path>
          <path d="M525.123901,622.980469 C516.751404,641.301331 506.510071,657.995178 493.451935,672.889160 C486.592743,680.712708 479.030334,687.681274 469.347626,691.930054 C457.711304,697.036133 447.463715,694.349609 439.690277,684.221436 C436.423096,679.964539 434.244537,675.076111 431.652283,670.427124 C419.267792,648.216797 402.269897,631.429382 377.176605,624.211487 C371.405090,622.551392 365.494690,621.312927 359.492523,621.469360 C354.815887,621.591370 354.071747,619.321655 354.872833,615.603821 C356.553192,607.805054 360.369873,600.983887 364.946747,594.587280 C375.956757,579.199890 390.227772,567.248413 405.679321,556.638733 C421.352722,545.876831 437.457184,535.806519 455.459473,529.302063 C467.699982,524.879395 480.265228,522.573303 493.132935,526.331177 C510.127136,531.294128 518.925110,544.299622 524.920410,559.763977 C529.160034,570.699768 531.057434,582.196167 532.185730,593.808838 C533.192627,604.171875 529.002258,613.364502 525.123901,622.980469 z"></path>
          <path d="M223.716064,722.279541 C221.529663,724.138367 220.328339,721.980774 218.950317,721.193481 C207.996887,714.936218 200.295578,715.402405 190.424515,723.125305 C181.679794,729.966919 172.450897,729.046753 164.748367,720.565369 C157.100586,712.144287 157.194656,702.849609 165.233856,694.869019 C171.666061,688.483704 179.664246,686.614929 188.301346,688.393738 C206.955547,692.235596 218.020157,704.342712 223.716064,722.279541 z"></path>
        </svg>
      );
      const WalletIcon = ({ className }) => (
        <svg
            className={className}
            viewBox="0 0 24 24"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
        >
            <path d="M20 7H6C4.89543 7 4 7.89543 4 9V18C4 19.1046 4.89543 20 6 20H20C21.1046 20 22 19.1046 22 18V9C22 7.89543 21.1046 7 20 7Z" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"/>
            <path d="M4 11H22" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"/>
            <path d="M20 7H6C4.89543 7 4 7.89543 4 9V6C4 4.89543 4.89543 4 6 4H18C19.1046 4 20 4.89543 20 6V7Z" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"/>
        </svg>
      );
      const ChainIcon = ({ chainId, className }) => {
          const icons = {
              '0x1': ( // Ethereum
                  <svg className={className} viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                      <path d="M12 2.25 11.53 8.95 12 9.25 12.47 8.95 12 2.25zM12.47 9.95 12 10.25 11.53 9.95 6 12.42l5.53 3.63L12 15.75l.47.3 5.53-3.63L12.47 9.95zM12 21.75l5.96-8.72-5.49-3.61L12 9.72l-.47-.3-5.49 3.61L12 21.75z"/>
                  </svg>
              ),
              '0x89': ( // Polygon
                  <svg className={className} viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                      <path d="M16.69 6.45a.75.75 0 0 0-1.12-.32l-5.4 3.93-3-2.18a.75.75 0 0 0-1.04.2l-2.25 3.1a.75.75 0 0 0 .2 1.04l5.4 3.93-2.45 1.78a.75.75 0 0 0 .84 1.25l7.65-5.55a.75.75 0 0 0 .32-1.12l-2.25-3.1a.75.75 0 0 0-.2-.11zm-5.94 4.3L12 10l2.25 3.1-4.5 3.27-2.46-1.78 4.71-3.44z"/>
                  </svg>
              ),
              '0x38': ( // BSC
                  <svg className={className} viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                      <path d="M16.624 13.92l3.75-2.165-3.75-2.165-2.165 1.25 2.165 1.25-2.165 1.25 2.165 1.25zM12 12.04L14.165 13.3 12 14.55 9.835 13.3 12 12.04zM7.376 9.59L11.125 7.425 7.376 5.26 5.21 6.51l2.166 1.25-2.166 1.25L7.376 9.59zM2.03 14.28L5.78 12.115 2.03 9.95 0 11.2l2.03 1.185v3.83L0 17.38l2.03 1.185 2.165-1.25-2.165-1.25v-2.54zM21.97 9.95l-3.75 2.165 3.75 2.165L24 13.085l-2.03-1.185v-3.83l2.03-1.17L21.97 9.95z"/>
                  </svg>
              )
          };
          const defaultIcon = (
              <svg className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2">
                <path strokeLinecap="round" strokeLinejoin="round" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" />
              </svg>
          );
          return icons[chainId] || defaultIcon;
      };
      const VoteButton = ({ t, className = '' }) => (
          <a 
              href="https://get.unstoppabledomains.com/brave-peoples-choice-awards/" 
              target="_blank" 
              rel="noopener noreferrer"
              className={`inline-block px-8 py-3 bg-transparent border-2 border-vermilion text-vermilion text-lg font-semibold rounded-lg shadow-sm hover:bg-vermilion hover:text-white transition-all duration-300 transform hover:scale-105 ${className}`}
          >
              {t.voteForMe}
          </a>
      );
      
      // =================================================================================
      // 4. MODAL COMPONENTS
      // =================================================================================
      const NFTModal = ({ onClose, t, walletAddress, onConnectWallet }) => (
          <div className="fixed inset-0 bg-black/30 backdrop-blur-sm z-50 flex items-center justify-center animate-fade-in" onClick={onClose}>
              <div className="relative bg-paper/95 dark:bg-dark-bg/95 rounded-xl shadow-2xl border border-ink/10 dark:border-dark-text/10 p-6 w-[calc(100vw-2rem)] max-w-sm text-center" onClick={e => e.stopPropagation()}>
                  <button onClick={onClose} className="absolute top-2 right-2 p-1 rounded-full hover:bg-ink/10 dark:hover:bg-dark-text/10" aria-label={t.closeModal}>
                      <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 text-ink dark:text-dark-text" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><path strokeLinecap="round" strokeLinejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
                  </button>
                  <h2 className="text-xl font-bold text-vermilion mb-4">{t.mintAsNFT}</h2>
                  {walletAddress ? (
                      <div className="flex flex-col items-center justify-center gap-4 text-ink-light dark:text-dark-text">
                          <button className="w-full flex items-center justify-center gap-2 px-4 py-3 bg-ink/5 dark:bg-dark-text/5 rounded-lg border-2 border-dashed border-ink/20 dark:border-dark-text/20 cursor-not-allowed opacity-60">
                             <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><path strokeLinecap="round" strokeLinejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" /></svg>
                             <span>Upload Artwork</span>
                          </button>
                          <p className="text-lg font-semibold tracking-widest mt-2">{t.comingSoon}</p>
                      </div>
                  ) : (
                      <div className="flex flex-col items-center justify-center gap-4 text-ink-light dark:text-dark-text">
                        <h3 className="text-lg font-semibold text-ink dark:text-dark-text">{t.connectToMint}</h3>
                        <p className="text-sm">{t.connectToMintDesc}</p>
                        <button onClick={onConnectWallet} className="w-full flex items-center justify-center gap-3 px-4 py-3 bg-vermilion/80 hover:bg-vermilion rounded-lg transition-colors font-semibold text-white">
                          <WalletIcon className="h-5 w-5" />
                          <span>{t.connectWallet}</span>
                        </button>
                      </div>
                  )}
              </div>
          </div>
      );
      const HowToUseModal = ({ onClose, t }) => {
          const [showVideoPlayer, setShowVideoPlayer] = useState(false);
          return (
              <div className="fixed inset-0 bg-black/30 backdrop-blur-sm z-50 flex items-center justify-center p-4 animate-fade-in" onClick={onClose}>
                  <div className="relative bg-paper/95 dark:bg-dark-bg/95 rounded-xl shadow-2xl border border-ink/10 dark:border-dark-text/10 p-6 w-full max-w-lg max-h-[90vh] overflow-y-auto" onClick={e => e.stopPropagation()}>
                      <button onClick={onClose} className="absolute top-2 right-2 p-1 rounded-full hover:bg-ink/10 dark:hover:bg-dark-text/10 z-10" aria-label={t.closeModal}>
                          <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 text-ink dark:text-dark-text" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><path strokeLinecap="round" strokeLinejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
                      </button>
                      <h2 className="text-xl font-bold text-vermilion mb-4">{t.howToUse}</h2>
                      {showVideoPlayer ? (
                          <div className="w-full aspect-video mb-4 rounded-lg overflow-hidden shadow-lg border border-ink/10 dark:border-dark-text/10"><iframe className="w-full h-full" src="https://www.youtube.com/embed/INLkBfEIsJM?si=olhVqRW0SmDzRJZs&autoplay=1" title={t.videoTitle} frameBorder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerPolicy="strict-origin-when-cross-origin" allowFullScreen></iframe></div>
                      ) : (
                          <div role="button" tabIndex="0" onClick={() => setShowVideoPlayer(true)} onKeyDown={(e) => { if (e.key === 'Enter' || e.key === ' ') setShowVideoPlayer(true); }} className="group block w-full aspect-video mb-4 rounded-lg overflow-hidden shadow-lg border border-ink/10 dark:border-dark-text/10 relative transition-transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-offset-2 dark:focus:ring-offset-dark-bg focus:ring-vermilion cursor-pointer" aria-label={t.videoTitle}>
                              <img src="https://i.ytimg.com/vi/INLkBfEIsJM/hqdefault.jpg" alt={t.videoTitle} className="w-full h-full object-cover" />
                              <div className="absolute inset-0 bg-black/30 group-hover:bg-black/50 transition-colors flex items-center justify-center">
                                  <svg xmlns="http://www.w3.org/2000/svg" className="h-16 w-16 text-white/80 group-hover:text-white transition-transform group-hover:scale-110" viewBox="0 0 20 20" fill="currentColor"><path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clipRule="evenodd" /></svg>
                              </div>
                          </div>
                      )}
                      <ul className="list-disc list-inside space-y-2 text-sm text-ink-light dark:text-dark-text">
                        <li><b>{t.draw}</b> {t.drawDesc}</li>
                        <li><b>{t.pan}</b> {t.panDesc}</li>
                        <li><b>{t.zoom}</b> {t.zoomDesc}</li>
                        <li className="pt-1">ðŸ’¡ {t.brushTip}</li>
                      </ul>
                  </div>
              </div>
          );
      };
      const WalletInfoModal = ({ onClose, t }) => (
        <div className="fixed inset-0 bg-black/30 backdrop-blur-sm z-50 flex items-center justify-center animate-fade-in" onClick={onClose}>
            <div className="relative bg-paper/95 dark:bg-dark-bg/95 rounded-xl shadow-2xl border border-ink/10 dark:border-dark-text/10 p-6 w-[calc(100vw-2rem)] max-w-sm text-center font-serif-sc" onClick={e => e.stopPropagation()}>
                <button onClick={onClose} className="absolute top-2 right-2 p-1 rounded-full hover:bg-ink/10 dark:hover:bg-dark-text/10" aria-label={t.closeModal}>
                    <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 text-ink dark:text-dark-text" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><path strokeLinecap="round" strokeLinejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
                <h2 className="text-xl font-bold text-vermilion mb-4">{t.walletRequired}</h2>
                <p className="text-ink-light dark:text-dark-text mb-6">{t.walletRequiredDesc}</p>
                <div className="flex flex-col gap-3">
                    <a href="https://brave.com/wallet/" target="_blank" rel="noopener noreferrer" className="w-full flex items-center justify-start gap-3 px-4 py-3 bg-ink/5 dark:bg-dark-text/5 rounded-lg border border-ink/20 dark:border-dark-text/20 hover:bg-ink/10 dark:hover:bg-dark-text/10 transition-colors font-semibold text-ink dark:text-dark-text">
                        <img alt="Brave Wallet" className="h-6 w-6" src="https://upload.wikimedia.org/wikipedia/commons/a/ac/Brave_Basic_Attention_Token_%28BAT%29_Logo.svg" />
                        <span>{t.braveWallet}</span>
                    </a>
                    <a href="https://metamask.io/download/" target="_blank" rel="noopener noreferrer" className="w-full flex items-center justify-start gap-3 px-4 py-3 bg-ink/5 dark:bg-dark-text/5 rounded-lg border border-ink/20 dark:border-dark-text/20 hover:bg-ink/10 dark:hover:bg-dark-text/10 transition-colors font-semibold text-ink dark:text-dark-text">
                        <img alt="MetaMask" className="h-6 w-6" src="https://upload.wikimedia.org/wikipedia/commons/3/36/MetaMask_Fox.svg" />
                        <span>{t.metaMask}</span>
                    </a>
                    <a href="https://www.binance.com/en/wallet" target="_blank" rel="noopener noreferrer" className="w-full flex items-center justify-start gap-3 px-4 py-3 bg-ink/5 dark:bg-dark-text/5 rounded-lg border border-ink/20 dark:border-dark-text/20 hover:bg-ink/10 dark:hover:bg-dark-text/10 transition-colors font-semibold text-ink dark:text-dark-text">
                        <img alt="Binance Wallet" className="h-6 w-6" src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/e8/Binance_Logo.svg/480px-Binance_Logo.svg.png" />
                        <span>{t.binanceWallet}</span>
                    </a>
                    <a href="https://www.okx.com/web3" target="_blank" rel="noopener noreferrer" className="w-full flex items-center justify-start gap-3 px-4 py-3 bg-ink/5 dark:bg-dark-text/5 rounded-lg border border-ink/20 dark:border-dark-text/20 hover:bg-ink/10 dark:hover:bg-dark-text/10 transition-colors font-semibold text-ink dark:text-dark-text">
                        <img alt="OKX Wallet" className="h-6 w-6" src="https://play-lh.googleusercontent.com/N00SbjLJJrhg4hbdnkk3Llk2oedNNgCU29DvR9cpep7Lr0VkzvBkmLqajWNgFb0d7IOO" />
                        <span>{t.okxWallet}</span>
                    </a>
                    <a href="https://phantom.app/" target="_blank" rel="noopener noreferrer" className="w-full flex items-center justify-start gap-3 px-4 py-3 bg-ink/5 dark:bg-dark-text/5 rounded-lg border border-ink/20 dark:border-dark-text/20 hover:bg-ink/10 dark:hover:bg-dark-text/10 transition-colors font-semibold text-ink dark:text-dark-text">
                        <img alt="Phantom Wallet" className="h-6 w-6" src="https://mintcdn.com/phantom-e50e2e68/fkWrmnMWhjoXSGZ9/resources/images/Phantom_SVG_Icon.svg?w=1100&fit=max&auto=format&n=fkWrmnMWhjoXSGZ9&q=85&s=d9602893116f9314145e2a303d675ccc" />
                        <span>{t.phantomWallet}</span>
                    </a>
                </div>
            </div>
        </div>
      );
      const BatModal = ({ onClose, t }) => (
          <div className="fixed inset-0 bg-black/30 backdrop-blur-sm z-50 flex items-center justify-center animate-fade-in" onClick={onClose}>
              <div className="relative bg-paper/95 dark:bg-dark-bg/95 rounded-xl shadow-2xl border border-ink/10 dark:border-dark-text/10 p-6 w-[calc(100vw-2rem)] max-w-sm text-center" onClick={e => e.stopPropagation()}>
                  <button onClick={onClose} className="absolute top-2 right-2 p-1 rounded-full hover:bg-ink/10 dark:hover:bg-dark-text/10" aria-label={t.closeModal}>
                      <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 text-ink dark:text-dark-text" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><path strokeLinecap="round" strokeLinejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
                  </button>
                  <h2 className="text-xl font-bold text-vermilion mb-4">{t.braveDonation}</h2>
                  <p className="text-ink-light dark:text-dark-text mb-6 text-left">{t.braveDonationDesc}</p>
                  <a href="https://brave.com/wallet/" target="_blank" rel="noopener noreferrer" className="w-full inline-flex items-center justify-center gap-3 px-4 py-3 bg-vermilion/80 hover:bg-vermilion rounded-lg transition-colors font-semibold text-white">
                      <img alt="Brave Wallet" className="h-6 w-6" src="https://upload.wikimedia.org/wikipedia/commons/a/ac/Brave_Basic_Attention_Token_%28BAT%29_Logo.svg" />
                      <span>{t.visitBraveWallet}</span>
                  </a>
              </div>
          </div>
      );
      const LightboxModal = ({ images, currentIndex, onClose, setCurrentIndex }) => {
          useEffect(() => {
              const handleKeyDown = (e) => {
                  if (e.key === 'Escape') onClose();
                  if (e.key === 'ArrowRight') setCurrentIndex(i => (i + 1) % images.length);
                  if (e.key === 'ArrowLeft') setCurrentIndex(i => (i - 1 + images.length) % images.length);
              };
              window.addEventListener('keydown', handleKeyDown);
              return () => window.removeEventListener('keydown', handleKeyDown);
          }, [images.length, onClose, setCurrentIndex]);

          if (!images || images.length === 0) return null;

          const currentImage = images[currentIndex];

          return (
            <div className="fixed inset-0 bg-black/80 backdrop-blur-md z-50 flex items-center justify-center animate-fade-in" onClick={onClose}>
                <div className="relative w-full h-full flex items-center justify-center p-4" onClick={(e) => e.target === e.currentTarget && onClose()}>
                    <img src={currentImage.url} alt={currentImage.name} className="max-w-[90vw] max-h-[80vh] object-contain rounded-lg shadow-2xl" />
                    
                    <button onClick={onClose} className="absolute top-4 right-4 text-white/80 hover:text-white transition-colors" aria-label="Close">
                        <svg xmlns="http://www.w3.org/2000/svg" className="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><path strokeLinecap="round" strokeLinejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
                    </button>

                    {images.length > 1 && (
                        <>
                            <button onClick={(e) => { e.stopPropagation(); setCurrentIndex(i => (i - 1 + images.length) % images.length); }} className="absolute left-4 top-1/2 -translate-y-1/2 p-2 bg-black/30 hover:bg-black/50 rounded-full text-white/80 hover:text-white transition-colors" aria-label="Previous">
                                <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><path strokeLinecap="round" strokeLinejoin="round" d="M15 19l-7-7 7-7" /></svg>
                            </button>
                            <button onClick={(e) => { e.stopPropagation(); setCurrentIndex(i => (i + 1) % images.length); }} className="absolute right-4 top-1/2 -translate-y-1/2 p-2 bg-black/30 hover:bg-black/50 rounded-full text-white/80 hover:text-white transition-colors" aria-label="Next">
                                <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><path strokeLinecap="round" strokeLinejoin="round" d="M9 5l7 7-7 7" /></svg>
                            </button>
                        </>
                    )}
                    
                    <div className="absolute bottom-4 left-1/2 -translate-x-1/2 px-4 py-2 bg-black/50 rounded-lg text-white/90 text-sm font-serif-sc">
                        {currentImage.name} ({currentIndex + 1} / {images.length})
                    </div>
                </div>
            </div>
          );
      };
      const FeatureUnavailableModal = ({ onClose, t }) => (
        <div className="fixed inset-0 bg-black/30 backdrop-blur-sm z-50 flex items-center justify-center animate-fade-in" onClick={onClose}>
            <div className="relative bg-paper/95 dark:bg-dark-bg/95 rounded-xl shadow-2xl border border-ink/10 dark:border-dark-text/10 p-6 w-[calc(100vw-2rem)] max-w-sm text-center" onClick={e => e.stopPropagation()}>
                <button onClick={onClose} className="absolute top-2 right-2 p-1 rounded-full hover:bg-ink/10 dark:hover:bg-dark-text/10" aria-label={t.closeModal}>
                    <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 text-ink dark:text-dark-text" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><path strokeLinecap="round" strokeLinejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
                <h2 className="text-xl font-bold text-vermilion mb-4">{t.featureUnavailable}</h2>
                <p className="text-ink-light dark:text-dark-text">{t.featureUnavailableDesc}</p>
            </div>
        </div>
      );

      // =================================================================================
      // 5. CORE UI COMPONENTS
      // =================================================================================
      const BrushCanvas = forwardRef(({ brushColor, brushSize, waterAmount, onHistoryChange }, ref) => {
          const canvasRef = useRef(null);
          const [strokesHistory, setStrokesHistory] = useState([[]]);
          const [historyIndex, setHistoryIndex] = useState(0);
          const [panOffset, setPanOffset] = useState({ x: 0, y: 0 });
          const [zoom, setZoom] = useState(1);
          const isDrawing = useRef(false);
          const isPanning = useRef(false);
          const currentStroke = useRef(null);
          const activePointers = useRef(new Map());
          const panStart = useRef({ pointers: [], distance: 0, center: { x: 0, y: 0 } });
          const getCanvasContext = useCallback(() => {
              const canvas = canvasRef.current;
              return canvas ? { canvas, ctx: canvas.getContext('2d') } : { canvas: null, ctx: null };
          }, []);
          const getPoint = useCallback((e, rect) => {
              const screenX = e.clientX - rect.left;
              const screenY = e.clientY - rect.top;
              return {
                  x: (screenX - panOffset.x) / zoom,
                  y: (screenY - panOffset.y) / zoom,
                  pressure: e.pressure > 0 ? e.pressure : 0.5,
                  time: performance.now(),
              };
          }, [panOffset, zoom]);
          const drawStroke = useCallback((ctx, dpr, stroke) => {
              if (!stroke || stroke.points.length === 0) return;
              ctx.strokeStyle = stroke.color;
              ctx.fillStyle = stroke.color;
              ctx.lineCap = 'round';
              ctx.lineJoin = 'round';
              const firstPoint = stroke.points[0];
              const firstPointScreen = {
                  x: (firstPoint.x * zoom + panOffset.x) * dpr,
                  y: (firstPoint.y * zoom + panOffset.y) * dpr,
              };
              const baseWidth = stroke.size * firstPoint.pressure;
              const startWidth = Math.max(stroke.size / 5, baseWidth);
              ctx.beginPath();
              ctx.arc(firstPointScreen.x, firstPointScreen.y, (startWidth * zoom * dpr) / 2, 0, 2 * Math.PI);
              ctx.fill();
              for (let i = 1; i < stroke.points.length; i++) {
                  const point = stroke.points[i];
                  const lastPoint = stroke.points[i - 1];
                  const dist = Math.hypot(point.x - lastPoint.x, point.y - lastPoint.y);
                  const timeDiff = point.time - lastPoint.time;
                  const speed = dist / (timeDiff || 1);
                  const currentBaseWidth = stroke.size * point.pressure;
                  const speedFactor = 2.0 - (stroke.water / 100 * 1.5);
                  const strokeWidth = Math.max(stroke.size / 5, currentBaseWidth - speed * speedFactor);
                  const lastScreen = { x: (lastPoint.x * zoom + panOffset.x) * dpr, y: (lastPoint.y * zoom + panOffset.y) * dpr };
                  const currentScreen = { x: (point.x * zoom + panOffset.x) * dpr, y: (point.y * zoom + panOffset.y) * dpr };
                  ctx.lineWidth = strokeWidth * zoom * dpr;
                  ctx.beginPath();
                  ctx.moveTo(lastScreen.x, lastScreen.y);
                  ctx.lineTo(currentScreen.x, currentScreen.y);
                  ctx.stroke();
              }
          }, [panOffset, zoom]);
          const redrawCanvas = useCallback(() => {
              const { canvas, ctx } = getCanvasContext();
              if (!canvas || !ctx) return;
              const dpr = window.devicePixelRatio || 1;
              ctx.clearRect(0, 0, canvas.width, canvas.height);
              const currentStrokes = strokesHistory[historyIndex] || [];
              currentStrokes.forEach(stroke => drawStroke(ctx, dpr, stroke));
          }, [getCanvasContext, strokesHistory, historyIndex, drawStroke]);
          useEffect(() => {
              const { canvas } = getCanvasContext();
              if (!canvas) return;
              const observer = new ResizeObserver(() => {
                  const dpr = window.devicePixelRatio || 1;
                  const rect = canvas.getBoundingClientRect();
                  canvas.width = rect.width * dpr;
                  canvas.height = rect.height * dpr;
                  redrawCanvas();
              });
              observer.observe(canvas);
              return () => observer.disconnect();
          }, [getCanvasContext, redrawCanvas]);
          useEffect(() => {
              redrawCanvas();
          }, [redrawCanvas]);
          const startDrawing = useCallback((e) => {
              const { canvas, ctx } = getCanvasContext();
              if (!canvas || !ctx) return;
              const rect = canvas.getBoundingClientRect();
              const point = getPoint(e, rect);
              isDrawing.current = true;
              currentStroke.current = { points: [point], color: brushColor, size: brushSize, water: waterAmount };
              const dpr = window.devicePixelRatio || 1;
              const screenX = (point.x * zoom + panOffset.x) * dpr;
              const screenY = (point.y * zoom + panOffset.y) * dpr;
              const baseWidth = brushSize * point.pressure;
              const startWidth = Math.max(brushSize / 5, baseWidth);
              ctx.fillStyle = brushColor;
              ctx.beginPath();
              ctx.arc(screenX, screenY, (startWidth * zoom * dpr) / 2, 0, 2 * Math.PI);
              ctx.fill();
          }, [getCanvasContext, getPoint, brushColor, brushSize, waterAmount, zoom, panOffset]);
          const draw = useCallback((e) => {
              if (!isDrawing.current) return;
              const { canvas, ctx } = getCanvasContext();
              if (!canvas || !ctx) return;
              const rect = canvas.getBoundingClientRect();
              const newPoint = getPoint(e, rect);
              const lastPoint = currentStroke.current.points[currentStroke.current.points.length - 1];
              currentStroke.current.points.push(newPoint);
              const dpr = window.devicePixelRatio || 1;
              const dist = Math.hypot(newPoint.x - lastPoint.x, newPoint.y - lastPoint.y);
              const timeDiff = newPoint.time - lastPoint.time;
              const speed = dist / (timeDiff || 1);
              const baseWidth = brushSize * newPoint.pressure;
              const speedFactor = 2.0 - (waterAmount / 100 * 1.5);
              const strokeWidth = Math.max(brushSize / 5, baseWidth - speed * speedFactor);
              const lastScreen = { x: (lastPoint.x * zoom + panOffset.x) * dpr, y: (lastPoint.y * zoom + panOffset.y) * dpr };
              const currentScreen = { x: (newPoint.x * zoom + panOffset.x) * dpr, y: (newPoint.y * zoom + panOffset.y) * dpr };
              ctx.strokeStyle = brushColor;
              ctx.lineWidth = strokeWidth * zoom * dpr;
              ctx.lineCap = 'round';
              ctx.lineJoin = 'round';
              ctx.beginPath();
              ctx.moveTo(lastScreen.x, lastScreen.y);
              ctx.lineTo(currentScreen.x, currentScreen.y);
              ctx.stroke();
          }, [getCanvasContext, getPoint, brushColor, brushSize, waterAmount, zoom, panOffset]);
          const stopDrawing = useCallback(() => {
              if (!isDrawing.current) return;
              isDrawing.current = false;
              if (currentStroke.current && currentStroke.current.points.length > 0) {
                  const newHistory = strokesHistory.slice(0, historyIndex + 1);
                  const lastStrokes = strokesHistory[historyIndex] || [];
                  newHistory.push([...lastStrokes, currentStroke.current]);
                  setStrokesHistory(newHistory);
                  setHistoryIndex(newHistory.length - 1);
              }
              currentStroke.current = null;
          }, [strokesHistory, historyIndex]);
          const handlePointerDown = useCallback((e) => {
              e.preventDefault();
              const { canvas } = getCanvasContext();
              if (e.target !== canvas) return;
              canvas.setPointerCapture(e.pointerId);
              activePointers.current.set(e.pointerId, { x: e.clientX, y: e.clientY });
              if (e.button === 1 || activePointers.current.size === 2) {
                  isPanning.current = true;
                  isDrawing.current = false;
                  const pointers = Array.from(activePointers.current.values());
                  const center = { x: (pointers[0].x + (pointers[1]?.x || pointers[0].x)) / 2, y: (pointers[0].y + (pointers[1]?.y || pointers[0].y)) / 2 };
                  const distance = pointers.length > 1 ? Math.hypot(pointers[0].x - pointers[1].x, pointers[0].y - pointers[1].y) : 0;
                  panStart.current = { center, distance };
              } else if (e.button === 0) {
                  isPanning.current = false;
                  startDrawing(e);
              }
          }, [getCanvasContext, startDrawing]);
          const handlePointerMove = useCallback((e) => {
              e.preventDefault();
              if (!activePointers.current.has(e.pointerId)) return;
              activePointers.current.set(e.pointerId, { x: e.clientX, y: e.clientY });
              if (isPanning.current) {
                  const pointers = Array.from(activePointers.current.values());
                  const newCenter = { x: (pointers[0].x + (pointers[1]?.x || pointers[0].x)) / 2, y: (pointers[0].y + (pointers[1]?.y || pointers[0].y)) / 2 };
                  const dx = newCenter.x - panStart.current.center.x;
                  const dy = newCenter.y - panStart.current.center.y;
                  let newPanOffset = { x: panOffset.x + dx, y: panOffset.y + dy };
                  let newZoom = zoom;
                  if (pointers.length > 1) {
                      const newDist = Math.hypot(pointers[0].x - pointers[1].x, pointers[0].y - pointers[1].y);
                      const oldDist = panStart.current.distance;
                      if (oldDist > 0) {
                          newZoom = Math.max(0.1, Math.min(10, zoom * (newDist / oldDist)));
                          const { canvas } = getCanvasContext();
                          const rect = canvas.getBoundingClientRect();
                          const mouseWorld = { x: (newCenter.x - rect.left - newPanOffset.x) / zoom, y: (newCenter.y - rect.top - newPanOffset.y) / zoom };
                          newPanOffset = { x: (newCenter.x - rect.left) - mouseWorld.x * newZoom, y: (newCenter.y - rect.top) - mouseWorld.y * newZoom };
                      }
                  }
                  setZoom(newZoom);
                  setPanOffset(newPanOffset);
                  panStart.current = { center: newCenter, distance: pointers.length > 1 ? Math.hypot(pointers[0].x - pointers[1].x, pointers[0].y - pointers[1].y) : 0 };
              } else if (isDrawing.current) {
                  draw(e);
              }
          }, [getCanvasContext, draw, panOffset, zoom]);
          const handlePointerUp = useCallback((e) => {
              e.preventDefault();
              const { canvas } = getCanvasContext();
              canvas.releasePointerCapture(e.pointerId);
              activePointers.current.delete(e.pointerId);
              if (isDrawing.current) {
                  stopDrawing();
              }
              if (isPanning.current && activePointers.current.size < 2 && e.button !== 1) {
                  isPanning.current = false;
              }
              if (activePointers.current.size === 0) {
                  isDrawing.current = false;
                  isPanning.current = false;
              }
          }, [getCanvasContext, stopDrawing]);
          const handleWheel = useCallback((e) => {
              e.preventDefault();
              const { canvas } = getCanvasContext();
              const rect = canvas.getBoundingClientRect();
              const zoomFactor = 1 - e.deltaY * 0.001;
              const newZoom = Math.max(0.1, Math.min(10, zoom * zoomFactor));
              const mouseWorld = { x: (e.clientX - rect.left - panOffset.x) / zoom, y: (e.clientY - rect.top - panOffset.y) / zoom };
              const newPanX = (e.clientX - rect.left) - mouseWorld.x * newZoom;
              const newPanY = (e.clientY - rect.top) - mouseWorld.y * newZoom;
              setZoom(newZoom);
              setPanOffset({ x: newPanX, y: newPanY });
          }, [getCanvasContext, panOffset, zoom]);
          useEffect(() => {
              const { canvas } = getCanvasContext();
              if (!canvas) return;
              canvas.addEventListener('pointerdown', handlePointerDown);
              canvas.addEventListener('pointermove', handlePointerMove);
              window.addEventListener('pointerup', handlePointerUp);
              canvas.addEventListener('wheel', handleWheel, { passive: false });
              canvas.addEventListener('contextmenu', e => e.preventDefault());
              return () => {
                  canvas.removeEventListener('pointerdown', handlePointerDown);
                  canvas.removeEventListener('pointermove', handlePointerMove);
                  window.removeEventListener('pointerup', handlePointerUp);
                  canvas.removeEventListener('wheel', handleWheel);
                  canvas.removeEventListener('contextmenu', e => e.preventDefault());
              };
          }, [getCanvasContext, handlePointerDown, handlePointerMove, handlePointerUp, handleWheel]);
          useEffect(() => {
              onHistoryChange(historyIndex > 0, historyIndex < strokesHistory.length - 1);
          }, [historyIndex, strokesHistory.length, onHistoryChange]);
          useImperativeHandle(ref, () => ({
              undo: () => setHistoryIndex(i => Math.max(0, i - 1)),
              redo: () => setHistoryIndex(i => Math.min(strokesHistory.length - 1, i + 1)),
              clear: () => {
                  const newHistory = strokesHistory.slice(0, historyIndex + 1);
                  newHistory.push([]);
                  setStrokesHistory(newHistory);
                  setHistoryIndex(newHistory.length - 1);
              },
              downloadPNG: () => {
                  const currentStrokes = strokesHistory[historyIndex];
                  if (!currentStrokes || currentStrokes.length === 0) return;
                  let minX = Infinity, minY = Infinity, maxX = -Infinity, maxY = -Infinity;
                  currentStrokes.forEach(stroke => {
                      stroke.points.forEach(p => {
                          minX = Math.min(minX, p.x);
                          minY = Math.min(minY, p.y);
                          maxX = Math.max(maxX, p.x);
                          maxY = Math.max(maxY, p.y);
                      });
                  });
                  const padding = 40;
                  const dpr = window.devicePixelRatio || 1;
                  const width = (maxX - minX) + padding * 2;
                  const height = (maxY - minY) + padding * 2;
                  const tempCanvas = document.createElement('canvas');
                  tempCanvas.width = width * dpr;
                  tempCanvas.height = height * dpr;
                  const tempCtx = tempCanvas.getContext('2d');
                  if (!tempCtx) return;
                  tempCtx.translate((-minX + padding) * dpr, (-minY + padding) * dpr);
                  const originalZoom = zoom;
                  const originalPanOffset = panOffset;
                  setZoom(1);
                  setPanOffset({ x: 0, y: 0 });
                  currentStrokes.forEach(stroke => {
                      // Need a version of drawStroke that ignores instance pan/zoom
                      if (!stroke || stroke.points.length === 0) return;
                      tempCtx.strokeStyle = stroke.color;
                      tempCtx.fillStyle = stroke.color;
                      tempCtx.lineCap = 'round';
                      tempCtx.lineJoin = 'round';
                      const firstPoint = stroke.points[0];
                      const baseWidth = stroke.size * firstPoint.pressure;
                      const startWidth = Math.max(stroke.size / 5, baseWidth);
                      tempCtx.beginPath();
                      tempCtx.arc(firstPoint.x * dpr, firstPoint.y * dpr, (startWidth * dpr) / 2, 0, 2 * Math.PI);
                      tempCtx.fill();
                      for (let i = 1; i < stroke.points.length; i++) {
                          const point = stroke.points[i];
                          const lastPoint = stroke.points[i - 1];
                          const dist = Math.hypot(point.x - lastPoint.x, point.y - lastPoint.y);
                          const timeDiff = point.time - lastPoint.time;
                          const speed = dist / (timeDiff || 1);
                          const currentBaseWidth = stroke.size * point.pressure;
                          const speedFactor = 2.0 - (stroke.water / 100 * 1.5);
                          const strokeWidth = Math.max(stroke.size / 5, currentBaseWidth - speed * speedFactor);
                          tempCtx.lineWidth = strokeWidth * dpr;
                          tempCtx.beginPath();
                          tempCtx.moveTo(lastPoint.x * dpr, lastPoint.y * dpr);
                          tempCtx.lineTo(point.x * dpr, point.y * dpr);
                          tempCtx.stroke();
                      }
                  });
                  setZoom(originalZoom);
                  setPanOffset(originalPanOffset);
                  const link = document.createElement('a');
                  link.download = 'signknature_artwork.png';
                  link.href = tempCanvas.toDataURL('image/png');
                  link.click();
              },
          }), [historyIndex, strokesHistory, panOffset, zoom, onHistoryChange]);
          return React.createElement('canvas', { ref: canvasRef, className: "w-full h-full" });
      });

      const Controls = ({ brushColor, setBrushColor, brushSize, setBrushSize, waterAmount, setWaterAmount, onClear, onUndo, onRedo, onDownloadClick, onMintClick, canUndo, canRedo, t, onInstructions }) => {
        const { width } = useWindowSize();
        const isCompactLayout = width > 0 && width < 880;
        const [isControlsExpanded, setIsControlsExpanded] = useState(false);
        const controlsPanelRef = useRef(null);

        const [isPickerOpen, setIsPickerOpen] = useState(false);
        const pickerRef = useRef(null);
        const [clickedSwatch, setClickedSwatch] = useState(null);
        const [isCustomColorActive, setIsCustomColorActive] = useState(false);
        const [hsv, setHsv] = useState({ h: 0, s: 0, v: 0, a: 1 });
        const buttonBaseClasses = "p-2 text-sm font-semibold rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 dark:focus:ring-offset-dark-bg focus:ring-vermilion focus:ring-opacity-75 transition-all duration-200 flex items-center justify-center";
        const enabledClasses = "hover:scale-105 active:scale-95";
        const disabledClasses = "opacity-50 cursor-not-allowed";

        useEffect(() => {
            const handleClickOutside = (event) => {
                if (controlsPanelRef.current && !controlsPanelRef.current.contains(event.target)) {
                    setIsControlsExpanded(false);
                }
            };
            if (isControlsExpanded) document.addEventListener('mousedown', handleClickOutside);
            return () => document.removeEventListener('mousedown', handleClickOutside);
        }, [isControlsExpanded]);

        useEffect(() => { if (isPickerOpen) { const { h, s, v, a } = parseColor(brushColor); setHsv({ h, s, v, a }); } }, [isPickerOpen, brushColor]);
        
        const handleColorChange = useCallback((newHsv) => {
            setHsv(newHsv); const { r, g, b } = hsvToRgb(newHsv.h, newHsv.s, newHsv.v); const newColor = `rgba(${r}, ${g}, ${b}, ${newHsv.a})`;
            setBrushColor(newColor); setClickedSwatch(null); setIsCustomColorActive(true);
        }, [setBrushColor]);
        
        const svPanelRef = useRef(null); const svPanelDraggable = useDraggable(svPanelRef, ({ x, y, width, height }) => handleColorChange({ ...hsv, s: x / width, v: 1 - y / height }));
        const hueSliderRef = useRef(null); const hueSliderDraggable = useDraggable(hueSliderRef, ({ x, width }) => handleColorChange({ ...hsv, h: x / width }));
        const alphaSliderRef = useRef(null); const alphaSliderDraggable = useDraggable(alphaSliderRef, ({ x, width }) => handleColorChange({ ...hsv, a: x / width }));
        const handleSwatchClick = (color) => { setBrushColor(color); setClickedSwatch(color); setIsPickerOpen(false); setIsCustomColorActive(false); };
        
        useEffect(() => {
            const handleClickOutside = (event) => { if (pickerRef.current && !pickerRef.current.contains(event.target)) setIsPickerOpen(false); };
            if (isPickerOpen) document.addEventListener('mousedown', handleClickOutside);
            return () => document.removeEventListener('mousedown', handleClickOutside);
        }, [isPickerOpen]);

        const customColorButtonStyle = isCustomColorActive
          ? { backgroundColor: brushColor, backgroundImage: parseColor(brushColor).a < 1 ? `url("data:image/svg+xml,%3Csvg width='10' height='10' viewBox='0 0 10 10' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' x='0' y='0' fill='%23ccc'/%3E%3Crect width='5' height='5' x='5' y='5' fill='%23ccc'/%3E%3C/svg%3E")` : 'none', backgroundSize: 'cover' }
          : { backgroundImage: 'linear-gradient(to right, #ff0000, #ffff00, #00ff00, #00ffff, #0000ff, #ff00ff)', backgroundColor: 'transparent' };

        const controlsContent = (
            <div className="flex flex-wrap items-center justify-center gap-2 sm:gap-4 w-full">
              <button onClick={onInstructions} className={`${buttonBaseClasses} ${enabledClasses} bg-paper dark:bg-ink-light text-ink dark:text-dark-text`} aria-label={t.instructions}>
                  <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                      <path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-1 1v1a1 1 0 102 0V8a1 1 0 00-1-1zM9 12a1 1 0 112 0v3a1 1 0 11-2 0v-3z" clipRule="evenodd" />
                  </svg>
              </button>
              <div className="flex items-center gap-2">
                {['#3f312b', '#c84c4c'].map((color, index) => (
                  <button key={color} onClick={() => handleSwatchClick(color)} className={`w-6 h-6 rounded-full transition-transform duration-150 border-2 ${clickedSwatch === color ? 'ring-2 ring-offset-2 dark:ring-offset-dark-bg ring-vermilion border-transparent' : 'border-ink/20 dark:border-dark-text/20'}`} style={{ backgroundColor: color }} aria-label={index === 0 ? t.setBrushColorInk : t.setBrushColorVermilion} />
                ))}
                <div className="relative" ref={pickerRef}>
                    <button onClick={() => setIsPickerOpen(prev => !prev)} className="w-6 h-6 rounded-full transition-transform duration-150 border-2 border-ink/20 dark:border-dark-text/20 bg-cover" style={customColorButtonStyle} aria-label={t.openColorPicker} />
                    {isPickerOpen && (
                        <div className="absolute bottom-full mb-2 left-1/2 -translate-x-1/2 p-4 bg-paper dark:bg-dark-bg rounded-lg shadow-2xl z-10 w-60 border border-ink/10 dark:border-dark-text/10">
                           <h3 className="text-sm font-semibold mb-3 text-ink dark:text-dark-text text-left">{t.customColor}</h3>
                           <div className="space-y-3">
                                <div ref={svPanelRef} {...svPanelDraggable} className="w-full h-32 rounded cursor-pointer relative" style={{ backgroundColor: `hsl(${hsv.h * 360}, 100%, 50%)` }}>
                                    <div className="absolute inset-0" style={{ background: 'linear-gradient(to right, white, transparent)' }} />
                                    <div className="absolute inset-0" style={{ background: 'linear-gradient(to top, black, transparent)' }} />
                                    <div className="w-3 h-3 rounded-full border-2 border-white shadow-md absolute transform -translate-x-1/2 -translate-y-1/2 pointer-events-none" style={{ top: `${(1 - hsv.v) * 100}%`, left: `${hsv.s * 100}%` }} />
                                </div>
                                <div ref={hueSliderRef} {...hueSliderDraggable} className="w-full h-4 rounded cursor-pointer relative" style={{ background: 'linear-gradient(to right, #f00, #ff0, #0f0, #0ff, #00f, #f0f, #f00)' }}>
                                    <div className="w-1 h-5 rounded-sm border-2 border-white shadow-md absolute transform -translate-x-1/2 -translate-y-[2px] pointer-events-none" style={{ left: `${hsv.h * 100}%` }} />
                                </div>
                                <div ref={alphaSliderRef} {...alphaSliderDraggable} className="w-full h-4 rounded cursor-pointer relative bg-white" style={{ backgroundImage: `linear-gradient(to right, transparent, hsl(${hsv.h * 360}, ${hsv.s * 100}%, ${hsv.v * 50}%)), url("data:image/svg+xml,%3Csvg width='10' height='10' viewBox='0 0 10 10' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' x='0' y='0' fill='%23ccc'/%3E%3Crect width='5' height='5' x='5' y='5' fill='%23ccc'/%3E%3C/svg%3E")` }}>
                                    <div className="w-1 h-5 rounded-sm border-2 border-white shadow-md absolute transform -translate-x-1/2 -translate-y-[2px] pointer-events-none" style={{ left: `${hsv.a * 100}%` }} />
                                </div>
                                <div className="flex items-center justify-between mt-2">
                                    <div className="w-8 h-8 rounded border border-ink/20 dark:border-dark-text/20 bg-cover" style={{ backgroundColor: `rgba(${hsvToRgb(hsv.h, hsv.s, hsv.v).r}, ${hsvToRgb(hsv.h, hsv.s, hsv.v).g}, ${hsvToRgb(hsv.h, hsv.s, hsv.v).b}, ${hsv.a})`, backgroundImage: `url("data:image/svg+xml,%3Csvg width='10' height='10' viewBox='0 0 10 10' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' x='0' y='0' fill='%23ccc'/%3E%3Crect width='5' height='5' x='5' y='5' fill='%23ccc'/%3E%3C/svg%3E")` }} />
                                    <span className="text-xs font-mono text-ink-light dark:text-dark-text">{`rgba(${hsvToRgb(hsv.h, hsv.s, hsv.v).r}, ${hsvToRgb(hsv.h, hsv.s, hsv.v).g}, ${hsvToRgb(hsv.h, hsv.s, hsv.v).b}, ${hsv.a.toFixed(2)})`}</span>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
              </div>
              
              <div className="flex items-center gap-2">
                  <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 text-ink-light dark:text-dark-text" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><path strokeLinecap="round" strokeLinejoin="round" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.5L15.232 5.232z" /></svg>
                  <input type="range" min="1" max="100" value={brushSize} onChange={(e) => setBrushSize(Number(e.target.value))} className="w-20 sm:w-24 h-2 bg-ink/20 dark:bg-dark-text/20 rounded-lg appearance-none cursor-pointer accent-vermilion" aria-label={t.brushSize} />
              </div>

              <div className="flex items-center gap-2">
                   <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 text-ink-light dark:text-dark-text" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><path strokeLinecap="round" strokeLinejoin="round" d="M12 22C12 22 6 15.29 6 10.2C6 5.22 8.69 2 12 2C15.31 2 18 5.22 18 10.2C18 15.29 12 22 12 22Z" /></svg>
                  <input type="range" min="0" max="100" value={waterAmount} onChange={(e) => setWaterAmount(Number(e.target.value))} className="w-20 sm:w-24 h-2 bg-ink/20 dark:bg-dark-text/20 rounded-lg appearance-none cursor-pointer accent-vermilion" aria-label={t.waterAmount} />
              </div>

              <div className="flex items-center gap-2">
                  <button onClick={onUndo} disabled={!canUndo} className={`${buttonBaseClasses} ${!canUndo ? disabledClasses : enabledClasses} bg-paper dark:bg-ink-light text-ink dark:text-dark-text`} aria-label={t.undo}>
                      <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fillRule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clipRule="evenodd" /></svg>
                  </button>
                  <button onClick={onRedo} disabled={!canRedo} className={`${buttonBaseClasses} ${!canRedo ? disabledClasses : enabledClasses} bg-paper dark:bg-ink-light text-ink dark:text-dark-text`} aria-label={t.redo}>
                      <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fillRule="evenodd" d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z" clipRule="evenodd" /></svg>
                  </button>
                  <button onClick={onClear} className={`${buttonBaseClasses} ${enabledClasses} bg-vermilion/80 hover:bg-vermilion text-white`} aria-label={t.clear}>
                      <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fillRule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 012 0v6a1 1 0 11-2 0V8z" clipRule="evenodd" /></svg>
                  </button>
              </div>
               <div className="flex items-center gap-2">
                  <button onClick={onDownloadClick} className={`${buttonBaseClasses} ${enabledClasses} bg-paper dark:bg-ink-light text-ink dark:text-dark-text`} aria-label={t.download}>
                      <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fillRule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clipRule="evenodd" /></svg>
                  </button>
                  <button onClick={onMintClick} className={`${buttonBaseClasses} ${enabledClasses} bg-paper dark:bg-ink-light text-ink dark:text-dark-text`} aria-label={t.uploadAsNFT}>
                      <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                          <path fillRule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM6.293 6.707a1 1 0 010-1.414l3-3a1 1 0 011.414 0l3 3a1 1 0 01-1.414 1.414L11 5.414V13a1 1 0 11-2 0V5.414L7.707 6.707a1 1 0 01-1.414 0z" clipRule="evenodd" opacity="0.6" />
                          <text x="10" y="12" textAnchor="middle" dominantBaseline="middle" fontSize="6" fontWeight="bold" className="fill-ink dark:fill-dark-text">NFT</text>
                      </svg>
                  </button>
              </div>
            </div>
        );

        if (isCompactLayout) {
            return (
                <div className="relative w-full flex justify-center" ref={controlsPanelRef}>
                    <button onClick={() => setIsControlsExpanded(p => !p)} className={`${buttonBaseClasses} ${enabledClasses} bg-paper dark:bg-ink-light text-ink dark:text-dark-text`} aria-label={t.toggleControls}>
                        <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2">
                            <path strokeLinecap="round" strokeLinejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                            <path strokeLinecap="round" strokeLinejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                        </svg>
                    </button>
                    {isControlsExpanded && (
                        <div className="absolute bottom-full mb-3 p-3 bg-paper/90 dark:bg-dark-bg/90 backdrop-blur-sm rounded-lg shadow-2xl border border-ink/10 dark:border-dark-text/10 animate-fade-in">
                           {controlsContent}
                        </div>
                    )}
                </div>
            )
        }
        return controlsContent;
      };
      const HeaderActions = ({ t, lang, setLang, isDarkMode, setIsDarkMode, handleBatClick, isMobile = false, onConnectWallet, walletAddress, chainId }) => {
        const textColorClasses = 'text-ink/80 hover:text-ink dark:text-dark-text/80 dark:hover:text-white';
        const shortenAddress = (address) => `${address.substring(0, 6)}...${address.substring(address.length - 4)}`;
        
        if (isMobile) {
            return (
                <div className="flex flex-col gap-2 items-start w-full">
                    <button onClick={onConnectWallet} className={`flex items-center gap-3 p-2 rounded-md w-full ${textColorClasses} hover:bg-ink/10 dark:hover:bg-dark-text/10`}>
                        {walletAddress ? (
                            <>
                                <ChainIcon chainId={chainId} className="h-6 w-6" />
                                <span className="font-mono text-sm">{shortenAddress(walletAddress)}</span>
                            </>
                        ) : (
                            <>
                                <WalletIcon className="h-6 w-6" />
                                <span>{t.connectWallet}</span>
                            </>
                        )}
                    </button>
                    <button onClick={handleBatClick} className={`flex items-center gap-3 p-2 rounded-md w-full ${textColorClasses} hover:bg-ink/10 dark:hover:bg-dark-text/10`}>
                        <img alt="Brave Wallet" className="h-6 w-6" src="https://upload.wikimedia.org/wikipedia/commons/a/ac/Brave_Basic_Attention_Token_%28BAT%29_Logo.svg" />
                        <span>Brave Wallet</span>
                    </button>
                    <button onClick={() => setLang(lang === 'zh-TW' ? 'en' : 'zh-TW')} className={`flex items-center gap-3 p-2 rounded-md w-full ${textColorClasses} hover:bg-ink/10 dark:hover:bg-dark-text/10`}>
                       <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><path strokeLinecap="round" strokeLinejoin="round" d="M3 5h12M9 3v2m4 13l4-4M19 17v-2a4 4 0 00-4-4H9a4 4 0 00-4 4v2m14-8a2 2 0 10-4 0 2 2 0 004 0zM3 21h18" /></svg>
                       <span>ä¸­/En</span>
                    </button>
                    <button onClick={() => setIsDarkMode(p => !p)} className={`flex items-center gap-3 p-2 rounded-md w-full ${textColorClasses} hover:bg-ink/10 dark:hover:bg-dark-text/10`}>
                       {isDarkMode ? 
                           (<svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><path strokeLinecap="round" strokeLinejoin="round" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" /></svg>) : 
                           (<svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><path strokeLinecap="round" strokeLinejoin="round" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" /></svg>)}
                       <span>{t.toggleTheme}</span>
                    </button>
                </div>
            )
        }

        return (
            <div className="flex items-center gap-2 sm:gap-4">
                <button onClick={onConnectWallet} title={t.wallet} className={`${textColorClasses} p-1.5 rounded-md hover:bg-ink/10 dark:hover:bg-dark-text/10 flex items-center gap-2`}>
                    {walletAddress ? (
                        <>
                            <ChainIcon chainId={chainId} className="h-5 w-5" />
                            <span className="text-sm font-mono">{shortenAddress(walletAddress)}</span>
                        </>
                    ) : (
                        <WalletIcon className="h-6 w-6" />
                    )}
                </button>
                <button onClick={handleBatClick} className="p-1 rounded-full" title="Brave Wallet">
                    <img alt="Brave Wallet" className="h-6 w-6" src="https://upload.wikimedia.org/wikipedia/commons/a/ac/Brave_Basic_Attention_Token_%28BAT%29_Logo.svg" />
                </button>
                <button onClick={() => setLang(lang === 'zh-TW' ? 'en' : 'zh-TW')} className={`text-sm font-semibold ${textColorClasses} transition-colors`} aria-label={t.toggleLanguage}>
                    ä¸­/En
                </button>
                <button onClick={() => setIsDarkMode(p => !p)} className={`${textColorClasses} p-1 rounded-full transition-colors`} aria-label={t.toggleTheme}>
                    {isDarkMode ? 
                        (<svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><path strokeLinecap="round" strokeLinejoin="round" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" /></svg>) : 
                        (<svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><path strokeLinecap="round" strokeLinejoin="round" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" /></svg>)}
                </button>
            </div>
        );
      };
      const Header = ({ setPage, currentPage, t, lang, setLang, isDarkMode, setIsDarkMode, handleBatClick, onConnectWallet, walletAddress, chainId, onGalleryClick, className = '' }) => {
          const [isMenuOpen, setIsMenuOpen] = useState(false);
          const { width } = useWindowSize();
          const isMobileLayout = width > 0 && width < 880;

          const navItems = [
              { name: t.home, page: 'welcome' },
              { name: t.about, page: 'about' },
              { name: t.canvas, page: 'canvas' },
              { name: t.gallery, page: 'gallery', disabled: true }, 
              { name: t.fonts, page: 'fonts', disabled: false },
              { name: t.competition, page: 'brave-scoring' },
          ];

          const navItemClasses = (page, isMobile = false) => {
              const base = isMobile ? 'p-2 rounded-md w-full text-left' : 'px-3 py-1 rounded-md text-sm font-medium';
              const active = 'bg-vermilion text-white';
              const inactive = isMobile ? 'hover:bg-ink/10 dark:hover:bg-dark-text/10' : 'hover:bg-ink/10 dark:hover:bg-dark-text/10';
              const disabled = 'opacity-50 cursor-not-allowed';
              return `${base} ${currentPage === page ? active : inactive} ${navItems.find(i=>i.page===page)?.disabled ? disabled : ''} transition-colors duration-200`;
          };
          
          const handleNavClick = (item) => {
            if (item.disabled) {
                if (item.page === 'gallery') {
                    onGalleryClick();
                    if (isMobileLayout) setIsMenuOpen(false);
                }
            } else {
                setPage(item.page);
                if (isMobileLayout) setIsMenuOpen(false);
            }
          };

          return (
              <>
                  <header className={`flex items-center justify-between p-4 sm:p-6 text-ink dark:text-dark-text ${className}`}>
                      <div className="flex items-center gap-3 cursor-pointer" onClick={() => setPage('welcome')}>
                          <BrandIcon className="h-8 w-8" />
                          <div className="font-bold text-xl tracking-wider sm:block">
                              S<span className="text-vermilion">in</span>g<span className="text-vermilion">k</span>nature
                          </div>
                      </div>
                      
                      {/* Desktop Menu */}
                      <div className={isMobileLayout ? 'hidden' : 'flex items-center gap-4'}>
                          <nav className="flex items-center gap-2">
                              {navItems.map(item => 
                                  <button 
                                      key={item.page} 
                                      onClick={() => handleNavClick(item)} 
                                      className={navItemClasses(item.page)}
                                  >
                                      {item.name}
                                  </button>
                              )}
                          </nav>
                          <HeaderActions t={t} lang={lang} setLang={setLang} isDarkMode={isDarkMode} setIsDarkMode={setIsDarkMode} handleBatClick={handleBatClick} onConnectWallet={onConnectWallet} walletAddress={walletAddress} chainId={chainId} />
                      </div>

                      {/* Mobile Menu Button */}
                      <div className={isMobileLayout ? 'block' : 'hidden'}>
                          <button onClick={() => setIsMenuOpen(true)} className="p-2 rounded-full hover:bg-ink/10 dark:hover:bg-dark-text/10" aria-label={t.openMenu}>
                              <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><path strokeLinecap="round" strokeLinejoin="round" d="M4 6h16M4 12h16M4 18h16" /></svg>
                          </button>
                      </div>
                  </header>

                  {/* Mobile Menu Panel */}
                  {isMenuOpen && (
                      <>
                          <div className="fixed inset-0 bg-black/30 backdrop-blur-sm z-40" onClick={() => setIsMenuOpen(false)} />
                          <div className="fixed top-4 left-4 w-[calc(100vw-2rem)] max-w-sm p-6 bg-paper/95 dark:bg-dark-bg/95 rounded-xl shadow-2xl border border-ink/10 dark:border-dark-text/10 z-50 animate-slide-in-left max-h-[calc(100vh-2rem)] overflow-y-auto text-ink dark:text-dark-text">
                              <div className="flex justify-between items-center mb-6">
                                  <h2 className="text-xl font-bold text-vermilion">{t.menu}</h2>
                                  <button onClick={() => setIsMenuOpen(false)} className="p-1 rounded-full hover:bg-ink/10 dark:hover:bg-dark-text/10" aria-label={t.closeMenu}>
                                      <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><path strokeLinecap="round" strokeLinejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
                                  </button>
                              </div>
                              <nav className="flex flex-col gap-2">
                                  {navItems.map(item => 
                                      <button key={item.page} onClick={() => handleNavClick(item)} className={navItemClasses(item.page, true)}>
                                          {item.name}
                                      </button>
                                  )}
                              </nav>
                              <hr className="my-4 border-ink/10 dark:border-dark-text/10" />
                              <div className="flex flex-col gap-2">
                                <HeaderActions t={t} lang={lang} setLang={setLang} isDarkMode={isDarkMode} setIsDarkMode={setIsDarkMode} handleBatClick={handleBatClick} isMobile={true} onConnectWallet={onConnectWallet} walletAddress={walletAddress} chainId={chainId} />
                              </div>
                          </div>
                      </>
                  )}
              </>
          );
      };

      // =================================================================================
      // 6. PAGE COMPONENTS
      // =================================================================================
      const WelcomePage = ({ setPage, t, lang, setLang, isDarkMode, setIsDarkMode, currentPage, handleBatClick, walletAddress, onConnectWallet, chainId, onGalleryClick }) => {
          return (
              <div className="relative flex flex-col items-center justify-center min-h-screen bg-paper dark:bg-dark-bg bg-grid-light dark:bg-grid-dark text-ink dark:text-dark-text p-4 transition-colors duration-300 overflow-hidden">
                  <Header setPage={setPage} currentPage={currentPage} t={t} lang={lang} setLang={setLang} isDarkMode={isDarkMode} setIsDarkMode={setIsDarkMode} handleBatClick={handleBatClick} walletAddress={walletAddress} onConnectWallet={onConnectWallet} chainId={chainId} onGalleryClick={onGalleryClick} className="absolute top-0 left-0 right-0 z-30" />
                  <main className="text-center flex flex-col items-center justify-center flex-grow animate-fade-in pt-20 pb-24 w-full">
                      <h1 className="text-4xl sm:text-6xl lg:text-8xl font-serif-sc font-bold tracking-wider my-8 text-shadow flex flex-col sm:flex-row flex-wrap justify-center items-center gap-y-2 sm:gap-y-0 sm:gap-x-4">
                          <span>
                            S<span className="text-vermilion">in</span>g<span className="text-vermilion">k</span>nature
                          </span>
                          <span>
                            ç¥žéŸ» Â· <span className="text-vermilion">å¢¨</span>è·¡
                          </span>
                      </h1>
                      <p className="text-md sm:text-lg max-w-2xl mx-auto leading-relaxed text-ink-light dark:text-dark-text/90">
                          {t.aboutAppDesc}
                      </p>
                      <div className="flex flex-col items-stretch sm:flex-row sm:items-center justify-center gap-6 mt-12">
                          <button 
                              onClick={() => setPage('canvas')} 
                              className="px-8 py-3 bg-vermilion text-white text-lg font-semibold rounded-lg shadow-lg hover:bg-red-700 transition-all duration-300 transform hover:scale-105">
                              {t.startCreating}
                          </button>
                          <VoteButton t={t} />
                      </div>
                  </main>
                  <footer className="absolute bottom-4 sm:bottom-8 text-center text-sm text-ink-light dark:text-dark-text/70">
                      <div className="border border-ink/10 dark:border-dark-text/30 rounded-lg p-3 sm:p-4 bg-paper/50 dark:bg-dark-bg/50 backdrop-blur-sm">
                          <p>{t.competitionNotice}</p>
                          <a href="https://get.unstoppabledomains.com/brave-website-competition/" target="_blank" rel="noopener noreferrer" className="text-vermilion hover:underline">
                              {t.learnMore}
                          </a>
                      </div>
                  </footer>
                  <style>{`
                      .text-shadow { text-shadow: 0 2px 10px rgba(0,0,0,0.5); }
                      .dark .text-shadow { text-shadow: 0 2px 10px rgba(0,0,0,0.8); }
                  `}</style>
              </div>
          );
      };
      const BraveScoringPage = ({ setPage, currentPage, t, lang, setLang, isDarkMode, setIsDarkMode, handleBatClick, walletAddress, onConnectWallet, chainId, onGalleryClick }) => {
          const Checkmark = () => <span className="text-green-500 dark:text-green-400">âœ”</span>;
          const Cross = () => <span className="text-red-500 dark:text-red-400 opacity-70">âœ˜</span>;
      
          return (
              <div className="relative flex flex-col items-center min-h-screen bg-paper dark:bg-dark-bg bg-grid-light dark:bg-grid-dark text-ink dark:text-dark-text p-4 transition-colors duration-300">
                  <Header setPage={setPage} currentPage={currentPage} t={t} lang={lang} setLang={setLang} isDarkMode={isDarkMode} setIsDarkMode={setIsDarkMode} handleBatClick={handleBatClick} walletAddress={walletAddress} onConnectWallet={onConnectWallet} chainId={chainId} onGalleryClick={onGalleryClick} className="absolute top-0 left-0 right-0 z-30" />
                  <main className="w-full max-w-5xl mx-auto flex-grow animate-fade-in pt-24 sm:pt-32 pb-24 px-4">
                      <h1 className="text-4xl sm:text-5xl font-serif-sc font-bold tracking-wider mb-8 text-shadow text-center">{t.braveScoringTitle}</h1>
                      <div className="text-center"><VoteButton t={t} className="mb-8" /></div>
                      <div className="bg-paper/60 dark:bg-dark-bg/60 backdrop-blur-sm border border-ink/10 dark:border-dark-text/20 rounded-lg p-6 sm:p-8 text-left text-ink dark:text-dark-text/90">
                          <p className="text-lg mb-6 text-ink-light dark:text-dark-text/90">{t.braveScoringIntro}</p>
                          <div className="overflow-x-auto">
                              <table className="w-full text-base border-collapse">
                                  <thead>
                                      <tr className="border-b border-ink/20 dark:border-dark-text/30">
                                          <th className="p-3 text-left font-semibold">{t.scoringItem}</th>
                                          <th className="p-3 text-center font-semibold w-28">{t.scoringMaxPoints}</th>
                                          <th className="p-3 text-center font-semibold w-28">{t.scoringThisWebsite}</th>
                                      </tr>
                                  </thead>
                                  <tbody>
                                      {/* Content & Media */}
                                      <tr className="border-b border-ink/10 dark:border-dark-text/20"><td colSpan="3" className="p-3 pt-6 font-bold text-vermilion">{t.scoringContentMedia} (25)</td></tr>
                                      <tr className="border-b border-ink/10 dark:border-dark-text/20"><td className="p-3">{t.scoringVideos}</td><td className="p-3 text-center">5</td><td className="p-3 text-center"><Checkmark /></td></tr>
                                      <tr className="border-b border-ink/10 dark:border-dark-text/20"><td className="p-3">{t.scoringImages}</td><td className="p-3 text-center">5</td><td className="p-3 text-center"><Checkmark /></td></tr>
                                      <tr className="border-b border-ink/10 dark:border-dark-text/20"><td className="p-3">{t.scoringExtLinks}</td><td className="p-3 text-center">5</td><td className="p-3 text-center"><Checkmark /></td></tr>
                                      <tr className="border-b border-ink/10 dark:border-dark-text/20"><td className="p-3">{t.scoringCTAs}</td><td className="p-3 text-center">5</td><td className="p-3 text-center"><Checkmark /></td></tr>
                                      <tr className="border-b border-ink/10 dark:border-dark-text/20"><td className="p-3">{t.scoringSocial}</td><td className="p-3 text-center">5</td><td className="p-3 text-center"><Checkmark /></td></tr>

                                      {/* Integrations & Interactivity */}
                                      <tr className="border-b border-ink/10 dark:border-dark-text/20"><td colSpan="3" className="p-3 pt-6 font-bold text-vermilion">{t.scoringIntegrations} (20)</td></tr>
                                      <tr className="border-b border-ink/10 dark:border-dark-text/20">
                                          <td className="p-3">
                                              {t.scoringBraveIntegrations.title}
                                              <ul className="list-disc list-inside pl-4 mt-2 text-sm text-ink/80 dark:text-dark-text/80 space-y-1">
                                                  <li><a href="https://etherscan.io/token/0x0d8775f648430679a709e98d2b0cb6250d2887ef" target="_blank" rel="noopener noreferrer" className="hover:text-vermilion underline">{t.scoringBraveIntegrations.item1}</a> (<Checkmark />)</li>
                                                  <li><a href="https://brave.com/search/api/" target="_blank" rel="noopener noreferrer" className="hover:text-vermilion underline">{t.scoringBraveIntegrations.item2}</a> (<Checkmark />)</li>
                                                  <li><a href="https://wallet-docs.brave.com/" target="_blank" rel="noopener noreferrer" className="hover:text-vermilion underline">{t.scoringBraveIntegrations.item3}</a> (<Checkmark />)</li>
                                              </ul>
                                          </td>
                                          <td className="p-3 align-top text-center">10</td>
                                          <td className="p-3 align-top text-center"><Checkmark /></td>
                                      </tr>
                                      <tr className="border-b border-ink/10 dark:border-dark-text/20"><td className="p-3">{t.scoringAnimations}</td><td className="p-3 text-center">5</td><td className="p-3 text-center"><Checkmark /></td></tr>
                                      <tr className="border-b border-ink/10 dark:border-dark-text/20"><td className="p-3">{t.scoringNav}</td><td className="p-3 text-center">5</td><td className="p-3 text-center"><Checkmark /></td></tr>

                                      {/* Design */}
                                      <tr className="border-b border-ink/10 dark:border-dark-text/20"><td colSpan="3" className="p-3 pt-6 font-bold text-vermilion">{t.scoringDesign} (35)</td></tr>
                                      <tr className="border-b border-ink/10 dark:border-dark-text/20"><td className="p-3">{t.scoringLayout}</td><td className="p-3 text-center">15</td><td className="p-3 text-center"><Checkmark /></td></tr>
                                      <tr className="border-b border-ink/10 dark:border-dark-text/20"><td className="p-3">{t.scoringBranding}</td><td className="p-3 text-center">15</td><td className="p-3 text-center"><Checkmark /></td></tr>
                                      <tr className="border-b border-ink/10 dark:border-dark-text/20"><td className="p-3">{t.scoringCopy}</td><td className="p-3 text-center">5</td><td className="p-3 text-center"><Checkmark /></td></tr>

                                      {/* Functionality & Performance */}
                                      <tr className="border-b border-ink/10 dark:border-dark-text/20"><td colSpan="3" className="p-3 pt-6 font-bold text-vermilion">{t.scoringFunctionality} (15)</td></tr>
                                      <tr className="border-b border-ink/10 dark:border-dark-text/20"><td className="p-3">{t.scoringNoBrokenLinks}</td><td className="p-3 text-center">5</td><td className="p-3 text-center"><Checkmark /></td></tr>
                                      <tr className="border-b border-ink/10 dark:border-dark-text/20"><td className="p-3">{t.scoringMobile}</td><td className="p-3 text-center">10</td><td className="p-3 text-center"><Checkmark /></td></tr>

                                      {/* Miscellaneous */}
                                      <tr className="border-b border-ink/10 dark:border-dark-text/20"><td colSpan="3" className="p-3 pt-6 font-bold text-vermilion">{t.scoringMisc} (10)</td></tr>
                                      <tr><td className="p-3">{t.scoringOriginality}</td><td className="p-3 text-center">10</td><td className="p-3 text-center"><Checkmark /></td></tr>
                                  </tbody>
                              </table>
                          </div>
                      </div>
                  </main>
                  <footer className="absolute bottom-4 sm:bottom-8 text-center text-sm text-ink-light dark:text-dark-text/70">
                      <div className="border border-ink/10 dark:border-dark-text/30 rounded-lg p-3 sm:p-4 bg-paper/50 dark:bg-dark-bg/50 backdrop-blur-sm">
                          <p>{t.competitionNotice}</p>
                          <a href="https://get.unstoppabledomains.com/brave-website-competition/" target="_blank" rel="noopener noreferrer" className="text-vermilion hover:underline">
                              {t.learnMore}
                          </a>
                      </div>
                  </footer>
              </div>
          );
      };
      const AboutPage = ({ setPage, currentPage, t, lang, setLang, isDarkMode, setIsDarkMode, handleBatClick, walletAddress, onConnectWallet, chainId, onGalleryClick }) => {
          return (
              <div className="relative flex flex-col items-center min-h-screen bg-paper dark:bg-dark-bg bg-grid-light dark:bg-grid-dark text-ink dark:text-dark-text p-4 transition-colors duration-300">
                  <Header setPage={setPage} currentPage={currentPage} t={t} lang={lang} setLang={setLang} isDarkMode={isDarkMode} setIsDarkMode={setIsDarkMode} handleBatClick={handleBatClick} walletAddress={walletAddress} onConnectWallet={onConnectWallet} chainId={chainId} onGalleryClick={onGalleryClick} className="absolute top-0 left-0 right-0 z-30" />
                  <main className="w-full max-w-4xl mx-auto flex-grow animate-fade-in pt-24 sm:pt-32 pb-24 px-4">
                      <div className="bg-paper/60 dark:bg-dark-bg/60 backdrop-blur-sm border border-ink/10 dark:border-dark-text/20 rounded-lg p-6 sm:p-8 text-left text-ink-light dark:text-dark-text/90">
                          <h1 className="text-3xl sm:text-4xl font-serif-sc font-bold tracking-wider mb-6 text-shadow text-vermilion">{t.aboutApp}</h1>
                          <p className="mb-4">{t.aboutAppDesc}</p>
                          <ul className="list-disc list-inside space-y-1 text-sm text-ink-light/80 dark:text-dark-text/80 mb-8">
                              <li>{t.poweredByGemini}</li>
                              <li>{t.braveCompetition}</li>
                          </ul>

                          <hr className="my-8 border-ink/10 dark:border-dark-text/20" />

                          <h2 className="text-2xl sm:text-3xl font-serif-sc font-bold tracking-wider mb-4 text-shadow text-vermilion">{t.acknowledgements}</h2>
                          <p className="mb-6">{t.acknowledgementsDesc}</p>
                           <a href="https://github.com/guanny/Singknature" target="_blank" rel="noopener noreferrer" className="inline-flex items-center gap-2 mb-6 text-ink-light dark:text-dark-text/80 hover:text-vermilion transition-colors">
                              <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="currentColor" viewBox="0 0 16 16"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.01 8.01 0 0 0 16 8c0-4.42-3.58-8-8-8z"/></svg>
                              <span>{t.viewOnGithub}</span>
                          </a>
                          <div className="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                              <div>
                                  <h3 className="font-semibold text-lg mb-2 text-ink dark:text-dark-text">{t.techStack}</h3>
                                  <ul className="list-disc list-inside space-y-1 text-sm">
                                      <li><a href="https://react.dev/" target="_blank" rel="noopener noreferrer" className="hover:text-vermilion">React.js</a></li>
                                      <li><a href="https://tailwindcss.com/" target="_blank" rel="noopener noreferrer" className="hover:text-vermilion">Tailwind CSS</a></li>
                                      <li><a href="https://babeljs.io/" target="_blank" rel="noopener noreferrer" className="hover:text-vermilion">Babel</a></li>
                                      <li><a href="https://brave.com/search/api/" target="_blank" rel="noopener noreferrer" className="hover:text-vermilion">Brave Search API</a></li>
                                  </ul>
                              </div>
                              <div>
                                  <h3 className="font-semibold text-lg mb-2 text-ink dark:text-dark-text">{t.assetsAndInspiration}</h3>
                                  <ul className="list-disc list-inside space-y-1 text-sm">
                                      <li><a href="https://digitalarchive.npm.gov.tw" target="_blank" rel="noopener noreferrer" className="hover:text-vermilion">åœ‹ç«‹æ•…å®®åšç‰©é™¢ é–‹æ”¾è³‡æ–™</a></li>
                                      <li><a href="https://commons.wikimedia.org" target="_blank" rel="noopener noreferrer" className="hover:text-vermilion">Wikimedia Commons</a></li>
                                      <li><a href="https://fonts.google.com/" target="_blank" rel="noopener noreferrer" className="hover:text-vermilion">Google Fonts</a></li>
                                      <li>{t.authorAvatarCredit}</li>
                                      <li>{t.inspirationCredit}</li>
                                  </ul>
                              </div>
                          </div>
                          
                          <hr className="my-8 border-ink/10 dark:border-dark-text/20" />

                          <h2 className="text-2xl sm:text-3xl font-serif-sc font-bold tracking-wider mb-6 text-shadow text-vermilion">{t.aboutAuthor}</h2>
                          <div className="flex flex-col sm:flex-row items-center gap-6">
                              <a href="https://ud.me/guanny.brave" target="_blank" rel="noopener noreferrer" className="block transition-transform hover:scale-105 flex-shrink-0">
                                  <img src="https://i2.seadn.io/ethereum/0xe41bea6888f771a0c16d7188284522b76c135252/3d96a2344485f0814f1d7ea1d7b801/153d96a2344485f0814f1d7ea1d7b801.png?w=1000" alt="Guanny's Unstoppable Domains Avatar" className="w-32 h-32 border-2 border-ink/10 dark:border-dark-text/20 shadow-lg" style={{ clipPath: 'url(#rounded-hexagon)' }} />
                              </a>
                              <div>
                                  <p className="mb-4">{t.aboutAuthorDesc}</p>
                                  <div className="flex items-center justify-start gap-4">
                                      <a href="https://x.com/kuan_guanny" target="_blank" rel="noopener noreferrer" className="text-ink-light/80 dark:text-dark-text/80 hover:text-vermilion transition-colors"><svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="currentColor" viewBox="0 0 16 16"><path d="M12.6.75h2.454l-5.36 6.142L16 15.25h-4.937l-3.867-5.07-4.425 5.07H.316l5.733-6.57L0 .75h5.063l3.495 4.633L12.601.75Zm-.86 13.028h1.36L4.323 2.145H2.865l8.875 11.633Z"/></svg></a>
                                      <a href="https://www.instagram.com/kuan_guanny/" target="_blank" rel="noopener noreferrer" className="text-ink-light/80 dark:text-dark-text/80 hover:text-vermilion transition-colors"><svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="currentColor" viewBox="0 0 16 16"><path d="M8 0C5.829 0 5.556.01 4.703.048 3.85.088 3.269.222 2.76.42a3.9 3.9 0 0 0-1.417.923A3.9 3.9 0 0 0 .42 2.76C.222 3.268.087 3.85.048 4.703.01 5.555 0 5.827 0 8.001c0 2.172.01 2.444.048 3.297.04.852.174 1.433.372 1.942.205.526.478.972.923 1.417.444.445.89.719 1.416.923.51.198 1.09.333 1.942.372C5.555 15.99 5.827 16 8 16s2.444-.01 3.298-.048c.851-.04 1.434-.174 1.943-.372a3.9 3.9 0 0 0 1.416-.923c.445-.445.718-.891.923-1.417.197-.509.332-1.09.372-1.942C15.99 10.445 16 10.173 16 8s-.01-2.445-.048-3.299c-.04-.851-.175-1.433-.372-1.942a3.9 3.9 0 0 0-.923-1.417A3.9 3.9 0 0 0 13.24.42c-.51-.198-1.092-.333-1.943-.372C10.443.01 10.172 0 8 0zm0 1.442c2.136 0 2.389.007 3.232.046.78.035 1.204.166 1.486.275.373.145.64.319.92.599s.453.546.598.92c.11.281.24.705.275 1.485.039.843.047 1.096.047 3.231s-.008 2.389-.047 3.232c-.035.78-.166 1.203-.275 1.485a2.5 2.5 0 0 1-.598.92 2.5 2.5 0 0 1-.92.598c-.28.11-.704.24-1.485.276-.843.038-1.096.047-3.232.047s-2.39-.009-3.233-.047c-.78-.036-1.203-.166-1.485-.276a2.5 2.5 0 0 1-.92-.598 2.5 2.5 0 0 1-.598-.92c-.11-.281-.24-.705-.275-1.485-.038-.843-.046-1.096-.046-3.232s.008-2.389.046-3.232c.036-.78.166-1.204.276-1.486.145-.373.319-.64.599-.92s.546-.453.92-.598c.282-.11.705-.24 1.485-.276.843-.038 1.096-.047 3.232-.047zM8 3.882a4.118 4.118 0 1 0 0 8.236 4.118 4.118 0 0 0 0-8.236zM8 10.5a2.5 2.5 0 1 1 0-5 2.5 2.5 0 0 1 0 5zm4.75-6.844a.96.96 0 1 0 0 1.92.96.96 0 0 0 0-1.92z"/></svg></a>
                                      <a href="https://www.youtube.com/@kuan_guanny" target="_blank" rel="noopener noreferrer" className="text-ink-light/80 dark:text-dark-text/80 hover:text-vermilion transition-colors"><svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="currentColor" viewBox="0 0 576 512"><path d="M549.7 124.1c-6.3-23.7-24.8-42.3-48.3-48.6C458.8 64 288 64 288 64S117.2 64 74.6 75.5c-23.5 6.3-42 24.9-48.3 48.6-11.4 42.9-11.4 132.3-11.4 132.3s0 89.4 11.4 132.3c6.3 23.7 24.8 42.3 48.3 48.6C117.2 448 288 448 288 448s170.8 0 213.4-11.5c23.5-6.3 42-24.9 48.3-48.6 11.4-42.9 11.4-132.3 11.4-132.3s0-89.4-11.4-132.3zM232 340V172l144 84-144 84z"/></svg></a>
                                  </div>
                              </div>
                          </div>
                      </div>
                  </main>
              </div>
          );
      };
      const CanvasPage = ({ setPage, currentPage, t, lang, setLang, isDarkMode, setIsDarkMode, handleBatClick, walletAddress, onConnectWallet, chainId, onGalleryClick }) => {
          const [brushColor, setBrushColor] = useState('#3f312b');
          const [brushSize, setBrushSize] = useState(50);
          const [waterAmount, setWaterAmount] = useState(50);
          const brushCanvasRef = useRef(null);
          const [canUndo, setCanUndo] = useState(false);
          const [canRedo, setCanRedo] = useState(false);
          const [isNftModalOpen, setIsNftModalOpen] = useState(false);
          const [isHowToUseModalOpen, setIsHowToUseModalOpen] = useState(false);
          
          useEffect(() => {
            setBrushColor(isDarkMode ? '#e0d9cf' : '#3f312b');
          }, [isDarkMode]);

          const handleHistoryChange = useCallback((newCanUndo, newCanRedo) => {
              setCanUndo(newCanUndo); setCanRedo(newCanRedo);
          }, []);

          const onUndo = () => brushCanvasRef.current?.undo();
          const onRedo = () => brushCanvasRef.current?.redo();
          const onClear = () => brushCanvasRef.current?.clear();
          const onDownload = () => brushCanvasRef.current?.downloadPNG();

          return (
            <div className="flex flex-col h-screen bg-paper dark:bg-dark-bg">
              <Header 
                  setPage={setPage} currentPage={currentPage} t={t} lang={lang} 
                  setLang={setLang} isDarkMode={isDarkMode} setIsDarkMode={setIsDarkMode} 
                  handleBatClick={handleBatClick} walletAddress={walletAddress} onConnectWallet={onConnectWallet} chainId={chainId} onGalleryClick={onGalleryClick}
                  className="border-b border-ink/10 dark:border-dark-text/10 shadow-sm relative z-30" 
              />
              <main className="flex-grow relative overflow-hidden touch-none">
                  <div className="absolute inset-0 bg-grid-light dark:bg-grid-dark"></div>
                  <div className="absolute inset-0">
                      <BrushCanvas ref={brushCanvasRef} brushColor={brushColor} brushSize={brushSize} waterAmount={waterAmount} onHistoryChange={handleHistoryChange} />
                  </div>
              </main>
              <footer className="p-4 bg-paper/80 dark:bg-dark-bg/80 backdrop-blur-sm border-t border-ink/10 dark:border-dark-text/10 shadow-inner relative z-20">
                <Controls 
                  brushColor={brushColor} setBrushColor={setBrushColor} brushSize={brushSize} setBrushSize={setBrushSize} 
                  waterAmount={waterAmount} setWaterAmount={setWaterAmount}
                  onClear={onClear} onUndo={onUndo} onRedo={onRedo} 
                  onDownloadClick={onDownload}
                  onMintClick={() => setIsNftModalOpen(true)}
                  canUndo={canUndo} canRedo={canRedo} t={t} 
                  onInstructions={() => setIsHowToUseModalOpen(true)} />
              </footer>
              {isNftModalOpen && <NFTModal onClose={() => setIsNftModalOpen(false)} t={t} walletAddress={walletAddress} onConnectWallet={onConnectWallet} />}
              {isHowToUseModalOpen && <HowToUseModal onClose={() => setIsHowToUseModalOpen(false)} t={t} />}
            </div>
          );
      };
       const FontsPage = ({ setPage, currentPage, t, lang, setLang, isDarkMode, setIsDarkMode, handleBatClick, walletAddress, onConnectWallet, chainId, onGalleryClick }) => {
          const calligraphers = t.calligraphers || [];
          const [preview, setPreview] = useState({ visible: false, url: '', style: {} });
          const [lightbox, setLightbox] = useState({ isOpen: false, images: [], currentIndex: 0 });
          const [searchQuery, setSearchQuery] = useState('');
          const [searchResults, setSearchResults] = useState(null);
          const [isLoadingSearch, setIsLoadingSearch] = useState(false);
          const [searchError, setSearchError] = useState(null);
          
          const handleSearch = async () => {
              if (!searchQuery.trim()) return;
              setIsLoadingSearch(true);
              setSearchError(null);
              setSearchResults(null);
              try {
                  const response = await fetch(`https://api.search.brave.com/res/v1/web/search?q=${encodeURIComponent(searchQuery)}`, {
                      headers: {
                          'Accept': 'application/json',
                          'X-Subscription-Token': process.env.BRAVE_SEARCH_API_KEY
                      }
                  });
                  if (!response.ok) {
                      throw new Error('Brave Search API request failed.');
                  }
                  const data = await response.json();
                  setSearchResults(data.web?.results || []);
              } catch (error) {
                  console.error("Search error:", error);
                  setSearchError(error.message);
              } finally {
                  setIsLoadingSearch(false);
              }
          };

          const handleMouseEnter = (e, url) => {
            const previewWidth = 200, previewHeight = 200, offsetX = 20, offsetY = 20;
            let x = e.clientX + offsetX;
            let y = e.clientY + offsetY;

            if (x + previewWidth > window.innerWidth) x = e.clientX - offsetX - previewWidth;
            if (y + previewHeight > window.innerHeight) y = e.clientY - offsetY - previewHeight;

            setPreview({ visible: true, url, style: { top: `${y}px`, left: `${x}px` } });
          };
          const handleMouseMove = (e) => {
              if (!preview.visible) return;
              const previewWidth = 200, previewHeight = 200, offsetX = 20, offsetY = 20;
              let x = e.clientX + offsetX;
              let y = e.clientY + offsetY;

              if (x + previewWidth > window.innerWidth) x = e.clientX - offsetX - previewWidth;
              if (y + previewHeight > window.innerHeight) y = e.clientY - offsetY - previewHeight;

              setPreview(p => ({ ...p, style: { top: `${y}px`, left: `${x}px`, opacity: 1 } }));
          };
          const handleMouseLeave = () => {
              setPreview({ visible: false, url: '', style: {} });
          };
          const openLightbox = (calligrapherIndex, workIndex) => {
              setLightbox({
                  isOpen: true,
                  images: calligraphers[calligrapherIndex].works,
                  currentIndex: workIndex
              });
          };

          return (
              <div className="relative flex flex-col items-center min-h-screen bg-paper dark:bg-dark-bg bg-grid-light dark:bg-grid-dark text-ink dark:text-dark-text p-4 transition-colors duration-300">
                  <Header setPage={setPage} currentPage={currentPage} t={t} lang={lang} setLang={setLang} isDarkMode={isDarkMode} setIsDarkMode={setIsDarkMode} handleBatClick={handleBatClick} walletAddress={walletAddress} onConnectWallet={onConnectWallet} chainId={chainId} onGalleryClick={onGalleryClick} className="absolute top-0 left-0 right-0 z-30" />
                  <main className="w-full max-w-7xl mx-auto flex-grow animate-fade-in pt-24 sm:pt-32 pb-24 px-4">
                      <h1 className="text-4xl sm:text-5xl font-serif-sc font-bold tracking-wider mb-4 text-shadow text-center">{t.fonts}</h1>
                      <p className="text-center text-md sm:text-lg max-w-3xl mx-auto text-ink-light dark:text-dark-text/90 mb-12">{t.fontsIntro}</p>
                      
                      <div className="mb-12">
                          <div className="relative max-w-2xl mx-auto">
                              <input 
                                  type="search" 
                                  value={searchQuery}
                                  onChange={(e) => setSearchQuery(e.target.value)}
                                  onKeyDown={(e) => {if (e.key === 'Enter') handleSearch();}}
                                  placeholder={t.searchPlaceholder}
                                  className="w-full pl-5 pr-28 py-3 text-base bg-paper/80 dark:bg-dark-bg/80 border-2 border-ink/20 dark:border-dark-text/20 rounded-full focus:ring-2 focus:ring-vermilion focus:border-vermilion outline-none transition-colors"
                              />
                              <button 
                                  onClick={handleSearch} 
                                  disabled={isLoadingSearch || !searchQuery.trim()}
                                  className="absolute right-2 top-1/2 -translate-y-1/2 px-5 py-2 bg-vermilion text-white font-semibold rounded-full hover:bg-red-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-all duration-200 flex items-center justify-center h-[80%]"
                              >
                                  {isLoadingSearch ? (
                                      <div className="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
                                  ) : t.searchButton}
                              </button>
                          </div>

                          <div className="mt-8 max-w-3xl mx-auto text-left">
                              {isLoadingSearch && <p className="text-center text-ink-light dark:text-dark-text/80">{t.loading}</p>}
                              {searchError && <p className="text-center text-vermilion">{t.searchError}</p>}
                              {searchResults && (
                                  searchResults.length > 0 ? (
                                      <>
                                      <ul className="space-y-6">
                                          {searchResults.map((result, index) => (
                                              <li key={index} className="p-4 bg-paper/40 dark:bg-dark-bg/40 border border-ink/10 dark:border-dark-text/10 rounded-lg transition-shadow hover:shadow-md">
                                                  <a href={result.url} target="_blank" rel="noopener noreferrer" className="block">
                                                      <h3 className="text-lg font-semibold text-vermilion hover:underline">{result.title}</h3>
                                                  </a>
                                                  <a href={result.url} target="_blank" rel="noopener noreferrer" className="text-sm text-green-700 dark:text-green-500 truncate block hover:underline" style={{direction: 'ltr'}}>{result.url}</a>
                                                  <p className="mt-1 text-sm text-ink-light dark:text-dark-text/80">{result.description}</p>
                                              </li>
                                          ))}
                                      </ul>
                                      <p className="text-center text-xs mt-4 text-ink-light/70 dark:text-dark-text/70">{t.braveSearchCredit}</p>
                                      </>
                                  ) : (
                                      <p className="text-center text-ink-light dark:text-dark-text/80">{t.noResults}</p>
                                  )
                              )}
                          </div>
                      </div>

                      <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                          {calligraphers.map((c, calligrapherIndex) => (
                              <div key={c.id} className="bg-paper/60 dark:bg-dark-bg/60 backdrop-blur-sm border border-ink/10 dark:border-dark-text/20 rounded-lg p-6 flex flex-col sm:flex-row gap-6 transition-shadow hover:shadow-xl">
                                  <div className="flex-shrink-0">
                                      <img src={c.portrait} alt={c.name} className="w-32 h-32 object-cover rounded-full mx-auto sm:mx-0 border-2 border-ink/10 dark:border-dark-text/20 shadow-lg" />
                                  </div>
                                  <div className="text-center sm:text-left">
                                      <h2 className="text-2xl font-serif-sc font-bold text-vermilion">{c.name}</h2>
                                      <p className="text-sm text-ink-light dark:text-dark-text/80 mb-3">{c.era}</p>
                                      <p className="text-sm mb-1"><strong className="text-ink dark:text-dark-text">{c.style.split('ï¼š')[0]}</strong>: {c.style.split('ï¼š')[1]}</p>
                                      <p className="text-sm mb-4"><strong className="text-ink dark:text-dark-text">{c.features.split('ï¼š')[0]}</strong>: {c.features.split('ï¼š')[1]}</p>
                                      <div className="text-sm">
                                          <p className="font-semibold mb-1 text-ink dark:text-dark-text">ä»£è¡¨ä½œå“:</p>
                                          <ul className="flex flex-col sm:flex-row items-center justify-center sm:justify-start gap-x-4 gap-y-1">
                                              {c.works.map((work, workIndex) => (
                                                  <li key={work.name}>
                                                      <button 
                                                          onClick={() => openLightbox(calligrapherIndex, workIndex)}
                                                          onMouseEnter={(e) => handleMouseEnter(e, work.url)}
                                                          onMouseMove={handleMouseMove}
                                                          onMouseLeave={handleMouseLeave}
                                                          className="text-vermilion/80 hover:text-vermilion hover:underline"
                                                      >
                                                          {work.name}
                                                      </button>
                                                  </li>
                                              ))}
                                          </ul>
                                      </div>
                                  </div>
                              </div>
                          ))}
                      </div>
                  </main>
                  {preview.visible && (
                    <div 
                        className="pointer-events-none fixed z-50 transition-opacity duration-200 ease-out"
                        style={{ ...preview.style, opacity: 0 }}
                    >
                        <img src={preview.url} alt="preview" className="w-auto h-auto max-w-[200px] max-h-[200px] rounded-md shadow-2xl border-2 border-white bg-paper" />
                    </div>
                  )}
                  {lightbox.isOpen && (
                    <LightboxModal 
                        images={lightbox.images}
                        currentIndex={lightbox.currentIndex}
                        setCurrentIndex={(updater) => setLightbox(prev => ({...prev, currentIndex: typeof updater === 'function' ? updater(prev.currentIndex) : updater}))}
                        onClose={() => setLightbox(prev => ({ ...prev, isOpen: false }))}
                    />
                  )}
              </div>
          );
      };

      // =================================================================================
      // 7. MAIN APP COMPONENT
      // =================================================================================
      const App = () => {
          const [page, setPage] = useState('welcome');
          const [isDarkMode, setIsDarkMode] = useState(() => typeof window !== 'undefined' && window.matchMedia('(prefers-color-scheme: dark)').matches);
          const [lang, setLang] = useState('zh-TW');
          const [walletAddress, setWalletAddress] = useState(null);
          const [chainId, setChainId] = useState(null);
          const [isWalletInfoModalOpen, setIsWalletInfoModalOpen] = useState(false);
          const [isBatModalOpen, setIsBatModalOpen] = useState(false);
          const [isGalleryModalOpen, setIsGalleryModalOpen] = useState(false);
          const t = translations[lang];

          const handleBatClick = () => {
              setIsBatModalOpen(true);
          };

          const getWalletProvider = () => {
            if (typeof window.ethereum !== 'undefined') {
                return window.ethereum;
            }
            if (window.BinanceChain) {
                return window.BinanceChain;
            }
            if (window.okxwallet) {
                return window.okxwallet;
            }
            if (window.phantom?.ethereum) {
                return window.phantom.ethereum;
            }
            return null;
          };

          const handleConnectWallet = async () => {
            const provider = getWalletProvider();
            if (provider) {
              try {
                const accounts = await provider.request({ method: 'eth_requestAccounts' });
                setWalletAddress(accounts[0]);
                const currentChainId = await provider.request({ method: 'eth_chainId' });
                setChainId(currentChainId);
              } catch (err) {
                console.error('User rejected connection request.', err);
              }
            } else {
              setIsWalletInfoModalOpen(true);
            }
          };

          useEffect(() => { 
            const provider = getWalletProvider();
            if (provider) {
                const handleAccountsChanged = (accounts) => {
                    if (accounts.length > 0) {
                        setWalletAddress(accounts[0]);
                    } else {
                        setWalletAddress(null);
                        setChainId(null);
                    }
                };
                const handleChainChanged = (newChainId) => {
                    setChainId(newChainId);
                    window.location.reload();
                };
                
                provider.on('accountsChanged', handleAccountsChanged);
                provider.on('chainChanged', handleChainChanged);

                return () => {
                    provider.removeListener('accountsChanged', handleAccountsChanged);
                    provider.removeListener('chainChanged', handleChainChanged);
                };
            }
          }, []);

          useEffect(() => { 
            document.documentElement.lang = lang; 
          }, [lang]);
          
          useEffect(() => {
            document.documentElement.classList.toggle('dark', isDarkMode);
          }, [isDarkMode]);
          
          const renderPage = () => {
              const props = { setPage, currentPage: page, t, lang, setLang, isDarkMode, setIsDarkMode, handleBatClick, walletAddress, chainId, onConnectWallet: handleConnectWallet, onGalleryClick: () => setIsGalleryModalOpen(true) };
              switch(page) {
                  case 'canvas': return <CanvasPage {...props} />;
                  case 'brave-scoring': return <BraveScoringPage {...props} />;
                  case 'about': return <AboutPage {...props} />;
                  case 'fonts': return <FontsPage {...props} />;
                  case 'welcome': default: return <WelcomePage {...props} />;
              }
          };

          return (
            <div className="font-serif-sc text-ink dark:text-dark-text bg-paper dark:bg-dark-bg transition-colors duration-300">
              {renderPage()}
              {isWalletInfoModalOpen && <WalletInfoModal onClose={() => setIsWalletInfoModalOpen(false)} t={t} />}
              {isBatModalOpen && <BatModal onClose={() => setIsBatModalOpen(false)} t={t} />}
              {isGalleryModalOpen && <FeatureUnavailableModal onClose={() => setIsGalleryModalOpen(false)} t={t} />}
            </div>
          );
      };

      // =================================================================================
      // 8. RENDER APPLICATION
      // =================================================================================
      const container = document.getElementById('root');
      const root = ReactDOM.createRoot(container);
      root.render(<App />);
    </script>
</body>
</html>
